<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯" type="application/atom+xml">






<meta name="description" content="androidç¨‹åºå‘˜ä¸€æš,æ“…é•¿java,kotlin,python,é‡‘èæŠ•èµ„,æ¬¢è¿äº¤æµ~">
<meta name="keywords" content="android,java,kotlin,golang,go,python,è‡ªåŠ¨åŒ–,é‡åŒ–,é‡‘è,php,docker,linux">
<meta property="og:type" content="website">
<meta property="og:title" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
<meta property="og:url" content="https://code.newban.cn/index.html">
<meta property="og:site_name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
<meta property="og:description" content="androidç¨‹åºå‘˜ä¸€æš,æ“…é•¿java,kotlin,python,é‡‘èæŠ•èµ„,æ¬¢è¿äº¤æµ~">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
<meta name="twitter:description" content="androidç¨‹åºå‘˜ä¸€æš,æ“…é•¿java,kotlin,python,é‡‘èæŠ•èµ„,æ¬¢è¿äº¤æµ~">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--è°·æ­Œå¹¿å‘ŠéªŒè¯ä»£ç -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--è°·æ­Œå¹¿å‘ŠéªŒè¯ä»£ç -->

<!--çŸ­é“¾å¹¿å‘Š-->
<!--<script type="text/javascript">
    var adfly_id = 25792435;
    var adfly_advert = 'banner';
    var popunder = false;
    var exclude_domains = ['code.newban.cn','newban.cn',  'localhost:4000'];
</script>
<script src="https://cdn.adf.ly/js/link-converter.js"></script>-->
<!--çŸ­é“¾å¹¿å‘Š-->



  <link rel="canonical" href="https://code.newban.cn/">





  <title>ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
  
<a href="https://www.github.com/songjianzaina" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ä¹±ç ä¸‰åƒ â€“ ç å‡ºä¸€ä¸ªæ–°ä¸–ç•Œ</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://www.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://code.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://code.newban.cn469.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="469.html" itemprop="url">ç¼–å†™ä¸€ä¸ªhexoæ’ä»¶ å®ç°å°†åšå®¢ä¸­çš„åŸåˆ›æ–‡ç« åŒæ­¥åˆ°å¾®ä¿¡å…¬ä¼—å·</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2024-04-19T10:14:19+08:00">
                2024-04-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™ä¸ªéœ€æ±‚å¾ˆæ—©ä»¥å‰å°±æœ‰äº† ç”±äºå„ç§åŸå› è€½æäº†  è¿™æ¬¡å‡†å¤‡æŠŠè¿™ä¸ªåŠŸèƒ½æå®š</p>
<p>æˆ‘çš„å¤§æœ¬è¥åœ¨åšå®¢ä¸Š å¾®ä¿¡å…¬ä¼—å·åªæ˜¯é™„å¸¦ ä¸è¿‡è€ƒè™‘åˆ°å¾®ä¿¡æœç´¢æµé‡ä»¥åŠå…¬ä¼—å·çš„å¹¿å‘Šæ”¶ç›Š æ‰€ä»¥ è¿˜ç­‰ä»€ä¹ˆå‘¢ è‡ªåŠ¨åŒ–åœ°æèµ·æ¥ å˜¿å˜¿ğŸ˜œ</p>
<h2 id="åŠŸèƒ½å®ç°æµç¨‹"><a href="#åŠŸèƒ½å®ç°æµç¨‹" class="headerlink" title="åŠŸèƒ½å®ç°æµç¨‹"></a>åŠŸèƒ½å®ç°æµç¨‹</h2><p>æµç¨‹å¦‚ä¸‹:</p>
<ol>
<li>åœ¨æ‰§è¡Œ<code>hexo d</code>æŒ‡ä»¤æ˜¯ è·å–æ‰€æœ‰æ–‡ç« <code>html</code></li>
<li>å°†å†…å®¹ä¸­å¸¦æœ‰<code>æœ¬æ–‡ä¸ºä½œè€…åŸåˆ›</code>çš„æ–‡ç« è¿‡æ»¤å‡ºæ¥ å¹¶æ’é™¤<code>wx_pushed.txt</code>ä¸­å·²ç»åŒæ­¥çš„æ–‡ç« </li>
<li>æ›¿æ¢æ–‡ç« ä¸­çš„å›¾ç‰‡</li>
<li>å¢åŠ å°é¢å›¾</li>
<li>æ›¿æ¢å†…é“¾æ ·å¼</li>
<li>æ¨é€æ–‡ç« åˆ°å…¬ä¼—å·</li>
<li>æ¨é€æˆåŠŸåå°†æ–‡ç« æ–‡ä»¶åç§°è®°å½•åˆ°<code>wx_pushed.txt</code>ä¸­ é˜²æ­¢åé¢é‡å¤æ¨é€</li>
</ol>
<h2 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h2><p>æ’ä»¶ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hexo-wx-sync.js è‡ªåŠ¨å°†hexoåšå®¢ä¸­çš„åŸåˆ›æ–‡ç« åŒæ­¥åˆ°å¾®ä¿¡å…¬ä¼—å·</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">'axios'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; log &#125; = <span class="built_in">require</span>(<span class="string">'console'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>);</span><br><span class="line"><span class="keyword">var</span> req = <span class="built_in">require</span>(<span class="string">'request-promise'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PLUGIN_NAME = <span class="string">'hexo-wx-sync'</span>;</span><br><span class="line"><span class="keyword">const</span> PUSHED_ARTICLES_FILE = <span class="string">'wx_pushed.txt'</span>;</span><br><span class="line"><span class="keyword">const</span> config = hexo.config.wx_sync</span><br><span class="line"><span class="keyword">const</span> parentDir = path.dirname(__dirname);<span class="comment">//å½“å‰æ–‡ä»¶çš„çˆ¶ç›®å½• ä¹Ÿå°±æ˜¯hexo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ‰§è¡Œ hexo d æ—¶è§¦å‘</span></span><br><span class="line">hexo.extend.generator.register(<span class="string">'wechat'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">locals</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//è·å–å¾®ä¿¡å…¬ä¼—å·accesToken</span></span><br><span class="line">   accessToken=getAccessToken()</span><br><span class="line">  <span class="comment">// è·å–æ‰€æœ‰æ–‡ç« </span></span><br><span class="line">  <span class="keyword">const</span> posts = locals.posts;</span><br><span class="line">  <span class="comment">// éå†æ‰€æœ‰æ–‡ç« </span></span><br><span class="line">  posts.forEach(<span class="keyword">async</span> post =&gt; &#123;<span class="comment">//post.content è·å–çš„æ˜¯htmlæ ¼å¼å†…å®¹</span></span><br><span class="line">    <span class="comment">// è·å–æ–‡ç« è·¯å¾„</span></span><br><span class="line">    <span class="keyword">const</span> postPath = parentDir + <span class="string">"/source/"</span> + post.source;</span><br><span class="line">    <span class="comment">// è¯»å–markdownæ–‡ç« å†…å®¹</span></span><br><span class="line">    <span class="keyword">const</span> content = fs.readFileSync(postPath, <span class="string">'utf8'</span>);</span><br><span class="line">    <span class="comment">// è¿‡æ»¤ç¬¦åˆæ¡ä»¶çš„æ–‡ç« å¹¶æ›¿æ¢å†…å®¹</span></span><br><span class="line">    <span class="keyword">const</span> filteredContent = <span class="keyword">await</span> filterAndReplaceContent(post.content);</span><br><span class="line">    <span class="comment">// å¢åŠ å°é¢å›¾</span></span><br><span class="line">     <span class="keyword">const</span> coverImageId = <span class="keyword">await</span> addCoverImage(<span class="string">"https://source.unsplash.com/900x400/?book,library"</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"å‡†å¤‡å‘å¸ƒ"</span> + content)</span><br><span class="line">    <span class="comment">// è°ƒç”¨å¾®ä¿¡æ¥å£å‘å¸ƒæ–‡ç« </span></span><br><span class="line">    publishToWechat(content, post, coverImageId);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">filterAndReplaceContent</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ cheerio è§£æ HTML å†…å®¹</span></span><br><span class="line">  <span class="keyword">const</span> $ = cheerio.load(<span class="string">`&lt;article&gt;<span class="subst">$&#123;content&#125;</span>&lt;/article&gt;`</span>);</span><br><span class="line">  <span class="comment">// è¿‡æ»¤å¸¦æœ‰'æœ¬æ–‡ä¸ºä½œè€…åŸåˆ›'çš„æ–‡ç«  closestè¡¨ç¤ºæŸ¥æ‰¾å½“å‰å…ƒç´ æœ€è¿‘çš„ç¥–å…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> filteredContent = $(<span class="string">'p:contains("æœ¬æ–‡ä¸ºä½œè€…åŸåˆ›")'</span>).closest(<span class="string">'article'</span>).html();</span><br><span class="line">  <span class="comment">// æ›¿æ¢æ–‡ç« ä¸­çš„å›¾ç‰‡å’Œå†…é“¾æ ·å¼</span></span><br><span class="line">  <span class="comment">// è¿™é‡Œå‡è®¾ä½ å·²ç»å®ç°äº†ç›¸åº”çš„å‡½æ•°ï¼Œæ¯”å¦‚ replaceImages å’Œ replaceInternalLinks</span></span><br><span class="line">  <span class="keyword">const</span> replacedContent = <span class="keyword">await</span> replaceImages(filteredContent);</span><br><span class="line">  <span class="keyword">const</span> finalContent = <span class="keyword">await</span> replaceInternalLinks(replacedContent);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"æ–‡ç« è¿‡æ»¤å®Œæˆ"</span>)</span><br><span class="line">  <span class="keyword">return</span> finalContent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">publishToWechat</span>(<span class="params">parsedContent, metadata, coverImageId</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  axios.post(<span class="string">`https://api.weixin.qq.com/cgi-bin/draft/add?access_token=<span class="subst">$&#123;accessToken&#125;</span>`</span>, &#123;</span><br><span class="line">    articles: [&#123;</span><br><span class="line">      title: <span class="string">`<span class="subst">$&#123;metadata.title&#125;</span> `</span>,</span><br><span class="line">      thumb_media_id: coverImageId, <span class="comment">// åˆšæ‰å–åˆ°çš„å°é¢å›¾ç´ æ id</span></span><br><span class="line">      author: <span class="string">'ä¹±ç ä¸‰åƒ'</span>,</span><br><span class="line">      digest: metadata.title,</span><br><span class="line">      content: parsedContent, <span class="comment">// åˆšæ‰å¤„ç†å¥½çš„æ–‡ç« </span></span><br><span class="line">      content_source_url: <span class="string">`http://code.newban.cn/463.html`</span>, <span class="comment">// éå¿…å¡«ï¼Œè¿™é‡Œæˆ‘å†™çš„æ˜¯æˆ‘åšå®¢è¿™ç¯‡æ–‡ç« çš„ URL</span></span><br><span class="line">      need_open_comment: <span class="number">1</span>, <span class="comment">// æ˜¯å¦æ‰“å¼€ç•™è¨€åŠŸèƒ½</span></span><br><span class="line">      show_cover_pic: <span class="number">0</span>, <span class="comment">// æ˜¯å¦æŠŠå°é¢å›¾æ·»åŠ åˆ°æ–‡ç« å¼€å¤´</span></span><br><span class="line">    &#125;],</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¨é€æˆåŠŸä¼šè¿”å›ä¸€ä¸ªmedia_id </span></span><br><span class="line">    da = response.data</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'media_id'</span> <span class="keyword">in</span> da) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;metadata.title&#125;</span> successfully pushed to WeChat.`</span>);</span><br><span class="line">      <span class="comment">// è®°å½•å·²æ¨é€çš„æ–‡ç« åç§°åˆ° wx_pushed.txt æ–‡ä»¶ä¸­</span></span><br><span class="line">      fs.appendFileSync(PUSHED_ARTICLES_FILE, <span class="string">`<span class="subst">$&#123;metadata.source.replace(<span class="string">"_post/"</span>, <span class="string">""</span>).replace(<span class="string">"md"</span>, <span class="string">"html"</span>)&#125;</span>\n`</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(da)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">`Failed to push <span class="subst">$&#123;metadata.title&#125;</span> to WeChat: <span class="subst">$&#123;error&#125;</span>`</span>);</span><br><span class="line">  &#125;);;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›¿æ¢æ–‡ç« ä¸­çš„å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">replaceImages</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"å¼€å§‹æ›¿æ¢å›¾ç‰‡"</span>)</span><br><span class="line">  <span class="keyword">const</span> $ = cheerio.load(content);</span><br><span class="line">  $(<span class="string">'img'</span>).each(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> newUrl = <span class="keyword">await</span> uploadImg($(<span class="keyword">this</span>).attr(<span class="string">'src'</span>));</span><br><span class="line">    $(<span class="keyword">this</span>).attr(<span class="string">'src'</span>, newUrl);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"å›¾ç‰‡æ›¿æ¢å®Œæˆ"</span>)</span><br><span class="line">  <span class="keyword">return</span> $.html();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">option</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> req(option).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"è¯·æ±‚æˆåŠŸ: "</span> + response);</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"è¯·æ±‚é”™è¯¯: "</span> + err);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&#123;"media_id":"fTLNXU-IBCWKkfWOlCRS17gXwNG5_75-7aBJQalLz1BBBE5UJ43cj3JfxCyYiTN-"&#125;'</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šä¼ å›¾ç‰‡åˆ°ç´ æåº“å¹¶è·å–æ–°çš„å›¾ç‰‡åœ°å€</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">uploadImg</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"éœ€è¦ä¸Šä¼ çš„å›¾ç‰‡åœ°å€:"</span> + url)</span><br><span class="line">  <span class="keyword">const</span> imageStream = (<span class="keyword">await</span> axios.get(url, &#123; <span class="attr">responseType</span>: <span class="string">'stream'</span> &#125;)).data;</span><br><span class="line">  <span class="keyword">const</span> formData = &#123; <span class="attr">media</span>: imageStream &#125;;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> request(&#123;</span><br><span class="line">    url: <span class="string">`https://api.weixin.qq.com/cgi-bin/media/uploadimg?access_token=<span class="subst">$&#123;accessToken&#125;</span>`</span>,</span><br><span class="line">    method: <span class="string">'POST'</span>,</span><br><span class="line">    formData,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(res).url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">addCoverImage</span>(<span class="params">coverImage</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å®ç°å°é¢å›¾å¢åŠ é€»è¾‘</span></span><br><span class="line">  <span class="keyword">const</span> coverImageStream = (<span class="keyword">await</span> axios.get(coverImage, &#123; <span class="attr">responseType</span>: <span class="string">'stream'</span> &#125;)).data;</span><br><span class="line">  <span class="keyword">const</span> coverImageRes = <span class="keyword">await</span> request(&#123;</span><br><span class="line">    url: <span class="string">`https://api.weixin.qq.com/cgi-bin/material/add_material?access_token=<span class="subst">$&#123;accessToken&#125;</span>&amp;type=image`</span>,</span><br><span class="line">    method: <span class="string">'POST'</span>,</span><br><span class="line">    formData: &#123; <span class="attr">media</span>: coverImageStream &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> coverImageId = <span class="built_in">JSON</span>.parse(coverImageRes).media_id;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"å°é¢å›¾id:"</span> + coverImageId)</span><br><span class="line">  <span class="keyword">return</span> coverImageId;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAccessToken</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> axios.get(<span class="string">`https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=<span class="subst">$&#123;config.appid&#125;</span>&amp;secret=<span class="subst">$&#123;config.secret&#125;</span>`</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.status !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res.data.access_token;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">`è·å–accesTokenå¤±è´¥`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨æ–¹æ³•:</strong></p>
<p>åœ¨<code>script</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>è‡ªå®šä¹‰åç§°.js</code>æ–‡ä»¶,  æ³¨æ„åç§°ä¸è¦ä½¿ç”¨<code>index.js</code>, å°†ä¸Šé¢ä»£ç ç²˜è´´è¿‡å», ç„¶ååœ¨<code>config</code>é…ç½®æ–‡ä»¶ä¸­é…ç½®<code>AppID</code>å’Œ<code>AppSecret</code> å¦‚ä¸‹:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æ–‡ç« åŒæ­¥åˆ°å¾®ä¿¡å…¬ä¼—å·</span></span><br><span class="line"><span class="attr">wx_sync:</span></span><br><span class="line"><span class="attr">    enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    appid:</span> <span class="string">ä½ çš„appid</span></span><br><span class="line"><span class="attr">    secret:</span> <span class="string">ä½ çš„secret</span></span><br></pre></td></tr></table></figure>

<h2 id="å…³äºAppIDå’ŒAppSecretçš„è·å–"><a href="#å…³äºAppIDå’ŒAppSecretçš„è·å–" class="headerlink" title="å…³äºAppIDå’ŒAppSecretçš„è·å–"></a>å…³äºAppIDå’ŒAppSecretçš„è·å–</h2><p>å¼€å‘è€…ID(<code>AppID</code>)å’Œå¼€å‘è€…å¯†ç (<code>AppSecret</code>)å¯ä»¥åœ¨å…¬ä¼—å·åå°åŸºæœ¬é…ç½®ä¸­è·å–:</p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240419133336814.png" alt="image-20240419133336814"></p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240419133636776.png" alt="image-20240419133636776"></p>
<p>ä¸ºäº†ç¡®ä¿æ¥å£èƒ½æ­£å¸¸è®¿é—®, è¿˜éœ€è¦è®¾ç½®æ¥å£è¯·æ±‚æ‰€åœ¨åœ°çš„ipåœ°å€, å¦‚æœä½ åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨è°ƒç”¨è¿™äº›æ¥å£ åˆ™å¡«å…¥æœåŠ¡å™¨çš„<code>ip</code> , å¦‚æœæ˜¯æœ¬åœ°ç”µè„‘ åˆ™åœ¨ç™¾åº¦æœç´¢IPè·å–å½“å‰å…¬ç½‘IP:</p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240419134212591.png" alt="image-20240419134212591"></p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240419133544001.png" alt="image-20240419133544001"></p>
<p>æ–‡ç« å‚è€ƒ : ã€Š<a href="https://code.newban.cn/468.html">åšå®¢æ–‡ç« è‡ªåŠ¨åŒæ­¥å¾®ä¿¡å…¬ä¼—å·å®è·µ</a>ã€‹</p>
<p><strong>æœ¬æ–‡ä¸ºä½œè€…åŸåˆ› è½¬è½½æ—¶è¯·æ³¨æ˜å‡ºå¤„ è°¢è°¢</strong></p>
<p><img src="https://gitee.com/songjianzaina/SavePicGoPic/raw/master/img/20191119095516.png" alt></p>
<p><em><a href="https://code.newban.cn/">ä¹±ç ä¸‰åƒ â€“ ç‚¹æ»´ç§¯ç´¯ ,æ¬¢è¿æ¥åˆ°ä¹±ç ä¸‰åƒæŠ€æœ¯åšå®¢ç«™</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://code.newban.cn468.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="468.html" itemprop="url">åšå®¢æ–‡ç« è‡ªåŠ¨åŒæ­¥å¾®ä¿¡å…¬ä¼—å·å®è·µ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2024-04-17T12:14:19+08:00">
                2024-04-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ¬æ–‡æ¥è‡ª zhiyi çš„ä¸ªäººåšå®¢å®è·µï¼Œå¯ä»¥é€šè¿‡å¼€æ”¾èƒ½åŠ›å°†å…¶ä»–å¹³å°çš„æ–‡ç« åŒæ­¥åˆ°å¾®ä¿¡å…¬ä¼—å·ä¸Šï¼Œå¯¹åˆšå­¦å‰ç«¯çš„åŒå­¦ï¼ˆæœ‰è‡ªå·±çš„åšå®¢å°±æ›´å¥½äº†ï¼‰æ¥è¯´ï¼Œæ˜¯å¯¹åå°æ¥å£é“¾è·¯çš„ä¸€ä¸ªä¸é”™çš„æ¢ç´¢ã€‚</p>
<h3 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h3><p>å¾®ä¿¡å®˜æ–¹æä¾›äº†ç´ æç®¡ç†çš„ APIï¼Œé€šè¿‡ API å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡ŒåŒæ­¥ã€‚åœ¨ä½¿ç”¨ API ä¹‹å‰éœ€è¦è¿›è¡Œé‰´æƒï¼Œæ‰€ä»¥éœ€è¦å…ˆè·å– access tokenã€‚å¾®ä¿¡å…¬ä¼—å·ä¸­ä¸å…è®¸å‡ºç°å¤–åŸŸå›¾ç‰‡ï¼Œå› æ­¤éœ€è¦æŠŠæ–‡ç« é‡Œçš„å›¾ç‰‡å…¨éƒ¨ä½¿ç”¨å¾®ä¿¡çš„å›¾ç‰‡ä¸Šä¼ æ¥å£å¤„ç†åæ›¿æ¢ã€‚æ­¤å¤–ï¼Œå¾®ä¿¡å…¬ä¼—å·æ”¯æŒ HTML æ ‡ç­¾ä½†æ˜¯åªæ”¯æŒå†…è”æ ·å¼ï¼Œæ‰€ä»¥å¿…é¡»æŠŠå¤–è”æ ·å¼å…¨éƒ¨è½¬æ¢ä¸ºå†…è”æ ·å¼ã€‚</p>
<p>æ‰€ä»¥ï¼ŒåŒæ­¥åˆ°å¾®ä¿¡å…¬ä¼—å·çš„æ“ä½œï¼Œéœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>ä½¿ç”¨å…¬ä¼—å·çš„ appid å’Œ secret æ¢å– access tokenã€‚</li>
<li>æŠŠæ–‡ç« ä¸­çš„æ‰€æœ‰å›¾ç‰‡ç”¨å¾®ä¿¡å›¾ç‰‡ä¸Šä¼ æ¥å£ä¸Šä¼ ï¼Œå¹¶æ›¿æ¢æ–‡ç« é‡Œçš„ URLã€‚è¿™ä¸€æ­¥éœ€è¦ä½¿ç”¨ access token é‰´æƒã€‚</li>
<li>å°†æ–‡ç« ä¸­çš„æ‰€æœ‰å¤–è” css è½¬ä¸ºå†…è”æ ·å¼ã€‚</li>
<li>è°ƒç”¨å¾®ä¿¡ç´ æç®¡ç†æ¥å£ï¼ŒåŒæ­¥æ–‡ç« ã€‚è¿™é‡Œéœ€è¦ä½¿ç”¨ access token é‰´æƒã€‚</li>
</ol>
<h3 id="è·å–-access-token"><a href="#è·å–-access-token" class="headerlink" title="è·å– access token"></a>è·å– access token</h3><p>è·å– access token æœ¬èº«æ²¡ä»€ä¹ˆéš¾åº¦ï¼Œä½¿ç”¨å¾®ä¿¡å…¬ä¼—å·çš„ appid å’Œ secret å°±å¯ä»¥ä»æ¥å£è·å–åˆ°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ¥å£æœ‰è°ƒç”¨é¢‘ç‡é™åˆ¶ï¼ŒçŸ­æ—¶é—´å†…è°ƒç”¨æ¬¡æ•°ä¸èƒ½è¿‡å¤šã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬ä»å¾®ä¿¡çš„æ¥å£è·å– access token ä¹‹ååº”è¯¥å°†å®ƒç¼“å­˜ï¼Œä¹‹åç›´æ¥ä»ç¼“å­˜ä¸­è·å–ï¼Œç¼“å­˜å¤±æ•ˆäº†å†é‡æ–°ä»æ¥å£è·å–ã€‚è¿™é‡Œçš„ç¼“å­˜æœºåˆ¶ä½¿ç”¨äº† Redisï¼Œå› ä¸º Redis æä¾›çš„è¿‡æœŸå¤±æ•ˆæœºåˆ¶æ­£å¥½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬åœ¨ Koa çš„å…¨å±€å˜é‡é‡Œæ³¨å†Œ Redisï¼Œä»¥ä¾¿åœ¨å„ç§åœºæ™¯è°ƒç”¨ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠå®ƒå†™æˆ Koa ä¸­é—´ä»¶çš„å½¢å¼ï¼Œå¹¶æŠŠå‡ ä¸ª Redis å¸¸ç”¨æ“ä½œ Promise åŒ–ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">redisConfig</span>) =&gt;</span><span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> client = redis.createClient(redisConfig.port, redisConfig.host);</span><br><span class="line">  client.auth(redisConfig.password);</span><br><span class="line">  ctx.redis = &#123;</span><br><span class="line">    <span class="keyword">get</span>: (key) =&gt; new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">      client.get(key, (err, result) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resolve(result);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">set</span>: (key, value) =&gt; new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">      client.set(key, value, (err, result) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resolve(result);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;),</span><br><span class="line">    expire: <span class="function">(<span class="params">key, expire</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      client.expire(key, expire, (err, result) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resolve(result);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;),</span><br><span class="line">    del: <span class="function">(<span class="params">key</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      client.del(key, (err, result) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resolve(result);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¹‹åï¼Œåœ¨è·å–<code>access token</code> æ—¶ï¼Œå…ˆå°è¯•ä»<code>Redis</code>ä¸­å–ã€‚å¦‚æœè·å–åˆ°äº†ï¼Œå°±ç›´æ¥è¿”å›ç»“æœï¼›å¦‚æœæ²¡å–åˆ°ï¼Œå°±å‘å¾®ä¿¡æ¥å£è¯·æ±‚å¹¶å†™å…¥ Redisã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> accessToken = <span class="keyword">await</span> ctx.redis.get(<span class="string">'wechatAccessToken'</span>);</span><br><span class="line">    <span class="keyword">if</span> (!accessToken) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> axios.get(<span class="string">`https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=<span class="subst">$&#123;wechatConfig.appid&#125;</span>&amp;secret=<span class="subst">$&#123;wechatConfig.secret&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">if</span> (res?.status !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'get access token error'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      accessToken = res?.data?.access_token;</span><br><span class="line">      <span class="keyword">const</span> expiresIn = res?.data?.expires_in;</span><br><span class="line">      <span class="keyword">if</span> (!accessToken) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'get access token error'</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> ctx.redis.set(<span class="string">'wechatAccessToken'</span>, accessToken);</span><br><span class="line">        <span class="keyword">await</span> ctx.redis.expire(<span class="string">'wechatAccessToken'</span>, expiresIn);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(accessToken);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†è·å–å¹¶ç¼“å­˜<code>access token</code>ã€‚</p>
<h3 id="ä¸Šä¼ å¹¶æ›¿æ¢å›¾ç‰‡"><a href="#ä¸Šä¼ å¹¶æ›¿æ¢å›¾ç‰‡" class="headerlink" title="ä¸Šä¼ å¹¶æ›¿æ¢å›¾ç‰‡"></a>ä¸Šä¼ å¹¶æ›¿æ¢å›¾ç‰‡</h3><p>æˆ‘çš„æ–‡ç« å†…å®¹æ˜¯ä¸€æ®µ HTML ä»£ç å­—ç¬¦ä¸²ï¼Œè¿™æ˜¯ç”±å‰ç«¯ä¼ å…¥çš„ã€‚ä¸ç®¡å‰ç«¯ä½¿ç”¨ä»€ä¹ˆç¼–è¾‘å™¨ï¼Œè¿™ä¸€æ­¥éƒ½éœ€è¦å…ˆè½¬ä¸º HTML å­—ç¬¦ä¸²å†æ“ä½œã€‚</p>
<p>é¦–å…ˆéœ€è¦æŠŠæ–‡ç« å†…å®¹ä¸­çš„å›¾ç‰‡å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Œè¿™é‡Œç›´æ¥ç”¨æ­£åˆ™å³å¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> images = parsedContent.match(<span class="regexp">/&lt;img.*?(?:&gt;|\/&gt;)/gi</span>);</span><br><span class="line"><span class="keyword">if</span> (images) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> image <span class="keyword">of</span> images) &#123;</span><br><span class="line">    <span class="keyword">const</span> src = image.match(<span class="regexp">/src=['"]?([^'"]*)['"]?/i</span>);</span><br><span class="line">    <span class="keyword">const</span> url = src?.[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// å¯¹å–å‡ºçš„ URL åšå¤„ç†</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆåŒ¹é…æ‰€æœ‰çš„ <code>&lt;img /&gt;</code> æ ‡ç­¾ï¼Œä¹‹åé’ˆå¯¹æ¯ä¸ªæ ‡ç­¾å†åšä¸€æ¬¡åŒ¹é…ï¼Œå–åˆ°å…¶ä¸­çš„ src å€¼ï¼ˆä¹Ÿå°±æ˜¯å›¾ç‰‡çš„ URLï¼‰ã€‚</p>
<p>å¯¹åŒ¹é…åˆ°çš„å›¾ç‰‡ URL ä¾æ¬¡ä¸‹è½½ä¸º stream å¹¶ä¸Šä¼ åˆ°å¾®ä¿¡å…¬ä¼—å·å›¾ç‰‡ä¸Šä¼ æ¥å£ï¼Œä¹‹åä½¿ç”¨è¿”å›çš„å¾®ä¿¡åŸŸå†… URL æ›¿æ¢åŸæ–‡ä¸­çš„ URLã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (url) &#123;</span><br><span class="line">  <span class="keyword">const</span> imageStream = (<span class="keyword">await</span> axios.get(url, &#123; <span class="attr">responseType</span>: <span class="string">'stream'</span> &#125;)).data;</span><br><span class="line">  <span class="keyword">const</span> formData = &#123; <span class="attr">media</span>: imageStream &#125;;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> request(&#123;</span><br><span class="line">    url: <span class="string">`https://api.weixin.qq.com/cgi-bin/media/uploadimg?access_token=<span class="subst">$&#123;accessToken&#125;</span>`</span>,</span><br><span class="line">    method: <span class="string">'POST'</span>,</span><br><span class="line">    formData,</span><br><span class="line">  &#125;);</span><br><span class="line">  parsedContent = parsedContent.replace(url, <span class="built_in">JSON</span>.parse(res).url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ å›¾ç‰‡çš„æ¥å£å½“ç„¶éœ€è¦é‰´æƒï¼Œè¿™é‡Œçš„ access token æ˜¯ç›´æ¥ä½¿ç”¨ä¸Šä¸€æ­¥å°è£…å¥½çš„æ–¹æ³•è·å–çš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> accessToken = <span class="keyword">await</span> getWechatAccessToken(ctx);</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¼ åˆ°å¾®ä¿¡å…¬ä¼—å·å¿…é¡»ä½¿ç”¨ request æˆ–è€…åŸºäº request çš„ request-promiseã€‚å› ä¸º node ç¯å¢ƒçš„ axios å¯¹ form-data æ ¼å¼å‘é€æ–‡ä»¶çš„ POST å¹¶ä¸èƒ½å¾ˆå¥½åœ°æ”¯æŒã€‚</p>
<p>ä¸è¦å¿˜è®°äº†å¯¹å°é¢å›¾ä¹Ÿåšä¸€æ ·çš„å¤„ç†ï¼Œå› ä¸ºä½¿ç”¨ API ç¼–è¾‘å…¬ä¼—å·å›¾æ–‡å¿…é¡»æ·»åŠ å°é¢å›¾ï¼Œå°é¢å›¾ä¹Ÿå¿…é¡»æ˜¯å¾®ä¿¡åŸŸå†…çš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> coverImageStream = (<span class="keyword">await</span> axios.get(coverImage, &#123; <span class="attr">responseType</span>: <span class="string">'stream'</span> &#125;)).data;</span><br><span class="line"><span class="keyword">const</span> coverImageRes = <span class="keyword">await</span> request(&#123;</span><br><span class="line">  url: <span class="string">`https://api.weixin.qq.com/cgi-bin/material/add_material?access_token=<span class="subst">$&#123;accessToken&#125;</span>&amp;type=image`</span>,</span><br><span class="line">  method: <span class="string">'POST'</span>,</span><br><span class="line">  formData: &#123; <span class="attr">media</span>: coverImageStream &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> coverImageId = <span class="built_in">JSON</span>.parse(coverImageRes).media_id;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¼ å°é¢å›¾çš„æ¥å£å’Œä¸Šä¼ å›¾ç‰‡çš„æ¥å£æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¦æ³¨æ„åŒºåˆ†ã€‚æœ€åæˆ‘ä»¬æ‹¿åˆ°çš„æ˜¯å°é¢å›¾çš„ç´ æ idï¼Œè¿™ä¸ª id æˆ‘ä»¬åé¢åˆ›å»ºå›¾æ–‡ç´ ææ—¶ä¼šç”¨åˆ°ã€‚</p>
<p>æŠŠå°é¢å›¾å’Œæ–‡ç« ä¸­çš„å›¾ç‰‡éƒ½æ›¿æ¢ä¸€éåï¼Œæˆ‘ä»¬å°±å®Œæˆäº†è¿™ä¸€æ­¥ã€‚</p>
<h3 id="å¤–è”-CSS-è½¬ä¸ºå†…è”"><a href="#å¤–è”-CSS-è½¬ä¸ºå†…è”" class="headerlink" title="å¤–è” CSS è½¬ä¸ºå†…è”"></a>å¤–è” CSS è½¬ä¸ºå†…è”</h3><p>è¿™ä¸€æ­¥æˆ‘æœ¬æ¥ä»¥ä¸ºä¼šå¾ˆéº»çƒ¦ï¼Œä½†æ˜¯å¹¸è¿çš„æ˜¯ï¼Œåœ¨ node ä¸Šï¼ˆå‰ç«¯æµè§ˆå™¨ç­‰ç¯å¢ƒä¸å¯ä»¥ç”¨è¿™ä¸ªåŒ…ï¼Œä¼šæŠ¥é”™ï¼‰æœ‰ä¸€ä¸ªåä¸º <a href="https://mp.weixin.qq.com/s/mZeuVB6lpXQ1yKNULeG5tw" target="_blank" rel="noopener">juice</a> çš„ npm åŒ…å¯ä»¥å¸®æˆ‘ä»¬ä¸€è¡Œä»£ç å®Œæˆä»»åŠ¡ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">parsedContent = juice(<span class="string">`</span></span><br><span class="line"><span class="string">  &lt;style&gt;</span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;cssString&#125;</span></span></span><br><span class="line"><span class="string">  &lt;/style&gt;</span></span><br><span class="line"><span class="string">  &lt;div&gt;</span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;parsedContent&#125;</span></span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ <code>cssString</code> æ˜¯å®šä¹‰å¥½çš„å­—ç¬¦ä¸²ï¼Œäº‹å…ˆæŠŠéœ€è¦åº”ç”¨çš„ CSS ä»£ç å®šä¹‰å¥½ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡å³å¯ï¼›ç¬¬ä¸€ä¸ªå‚æ•°åˆ™æ˜¯éœ€è¦å¤„ç†çš„ HTML ä»£ç ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€æ­¥æ›¿æ¢å›¾ç‰‡ URL çš„ç»“æœã€‚</p>
<h3 id="è°ƒç”¨æ¥å£åˆ›å»ºç´ æ"><a href="#è°ƒç”¨æ¥å£åˆ›å»ºç´ æ" class="headerlink" title="è°ƒç”¨æ¥å£åˆ›å»ºç´ æ"></a>è°ƒç”¨æ¥å£åˆ›å»ºç´ æ</h3><p>åˆ°è¿™ä¸€æ­¥å·²ç»æ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼ŒæŒ‰ç…§å¾®ä¿¡å¼€å‘æ–‡æ¡£è°ƒç”¨æ¥å£å³å¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> axios.post(<span class="string">`https://api.weixin.qq.com/cgi-bin/draft/add?access_token=<span class="subst">$&#123;accessToken&#125;</span>`</span>, &#123;</span><br><span class="line">  articles: [&#123;</span><br><span class="line">    title: <span class="string">'ä½ çš„æ–‡ç« æ ‡é¢˜'</span>,</span><br><span class="line">    thumb_media_id: coverImageId, <span class="comment">// åˆšæ‰å–åˆ°çš„å°é¢å›¾ç´ æ id</span></span><br><span class="line">    author: <span class="string">'æ–‡ç« ä½œè€…'</span>,</span><br><span class="line">    digest: <span class="string">'æ–‡ç« æ‘˜è¦'</span>,</span><br><span class="line">    content: parsedContent, <span class="comment">// åˆšæ‰å¤„ç†å¥½çš„æ–‡ç« </span></span><br><span class="line">    content_source_url: <span class="string">'åŸæ–‡é“¾æ¥'</span>, <span class="comment">// éå¿…å¡«ï¼Œè¿™é‡Œæˆ‘å†™çš„æ˜¯æˆ‘åšå®¢è¿™ç¯‡æ–‡ç« çš„ URL</span></span><br><span class="line">    need_open_comment: <span class="number">1</span>, <span class="comment">// æ˜¯å¦æ‰“å¼€ç•™è¨€åŠŸèƒ½</span></span><br><span class="line">    show_cover_pic: <span class="number">0</span>, <span class="comment">// æ˜¯å¦æŠŠå°é¢å›¾æ·»åŠ åˆ°æ–‡ç« å¼€å¤´</span></span><br><span class="line">  &#125;],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥æˆåŠŸæŠŠæ–‡ç« åŒæ­¥åˆ°å¾®ä¿¡å…¬ä¼—å·åå°çš„ç´ æåº“ä¸­ã€‚æœ€ååœ¨å¾®ä¿¡å…¬ä¼—å·å®˜æ–¹å®¢æˆ·ç«¯ â€œè®¢é˜…å·åŠ©æ‰‹â€ æ“ä½œä¸€ä¸‹ï¼Œå°±å¯ä»¥æˆåŠŸæŠŠæ–‡ç« å‘å¸ƒå‡ºå»äº†ã€‚å½“ç„¶ï¼Œæœ€åçš„å‘å¸ƒæ“ä½œä¹Ÿå¯ä»¥è°ƒç”¨ API è§£å†³ï¼Œä¸è¿‡å®˜æ–¹å®¢æˆ·ç«¯æœ¬èº«å°±æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œä¸”å®˜æ–¹å®¢æˆ·ç«¯çš„ â€œé¢„è§ˆâ€ åŠŸèƒ½å¯ä»¥è®©æˆ‘æå‰çœ‹åˆ°æ•ˆæœï¼Œæ‰€ä»¥æˆ‘å°±ä¸å¿…å¤šæ­¤ä¸€ä¸¾äº†ã€‚</p>
<h3 id="å°šæœªè§£å†³çš„å°é—®é¢˜"><a href="#å°šæœªè§£å†³çš„å°é—®é¢˜" class="headerlink" title="å°šæœªè§£å†³çš„å°é—®é¢˜"></a>å°šæœªè§£å†³çš„å°é—®é¢˜</h3><p>è™½ç„¶åŒæ­¥åˆ°å¾®ä¿¡å…¬ä¼—å·è¿™ä¸ªåŠŸèƒ½å¸®æˆ‘æ‰“é€šäº†åœ¨æ‰‹æœºä¸Šåˆ›ä½œåˆ°å‘å¸ƒçš„æ•´ä¸ªé“¾è·¯ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸¤ä¸ªå°é—®é¢˜æš‚æ—¶æ²¡æ³•è§£å†³ï¼š</p>
<ol>
<li>å¾®ä¿¡å…¬ä¼—å·æœªæä¾›å£°æ˜åŸåˆ›çš„æ¥å£ï¼Œå®˜æ–¹å®¢æˆ·ç«¯ä¹Ÿæ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œå› æ­¤æƒ³è¦å£°æ˜åŸåˆ›æ–‡ç« è¿˜æ˜¯å¿…é¡»åœ¨ç”µè„‘ä¸Šæ“ä½œã€‚</li>
<li>å¾®ä¿¡å…¬ä¼—å·ç½‘é¡µç‰ˆç®¡ç†åå°æ”¯æŒå¯¹å°é¢å›¾è¿›è¡Œè‡ªå®šä¹‰è£å‰ªï¼Œè€Œé€šè¿‡ API æŒ‡å®šå°é¢å›¾åˆ™åªèƒ½ä½¿ç”¨å›¾ç‰‡ä¸­é—´éƒ¨åˆ†ã€‚</li>
</ol>
<h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><p><a href="https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html" target="_blank" rel="noopener">å¾®ä¿¡å…¬ä¼—å·å¼€å‘æ–‡æ¡£</a></p>
<p><strong>æœ¬æ–‡è½¬è½½è‡ª:</strong> <a href="https://mp.weixin.qq.com/s/mZeuVB6lpXQ1yKNULeG5tw" target="_blank" rel="noopener">å¾®ä¿¡å…¬ä¼—å·</a></p>
<p><img src="https://gitee.com/songjianzaina/SavePicGoPic/raw/master/img/20191119095516.png" alt></p>
<p><em><a href="https://code.newban.cn/">ä¹±ç ä¸‰åƒ â€“ ç‚¹æ»´ç§¯ç´¯ ,æ¬¢è¿æ¥åˆ°ä¹±ç ä¸‰åƒæŠ€æœ¯åšå®¢ç«™</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://code.newban.cn466.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="466.html" itemprop="url">2024å¹´å…³äºæ–°æµªå›¾åºŠå¤±æ•ˆçš„è§£å†³æ–¹æ³•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2024-04-17T10:14:19+08:00">
                2024-04-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆå¤šæ—©æœŸçš„ç«™é•¿åŸºæœ¬ä½¿ç”¨æ–°æµªçš„å›¾åºŠ, æ–°æµªå›¾åºŠå…è´¹åˆç¨³å®š, å—åˆ°å¾ˆå¤šäººçš„é’ç, æˆ‘æœ¬äººä¸æ€ä¹ˆç”¨æ–°æµªå›¾åºŠ, ä½†æ˜¯æ‰‹ä¸Šæœ‰ä¸€æ‰¹ç´ æ, å¼•ç”¨çš„æ˜¯æ–°æµªæœåŠ¡å™¨ä¸­çš„å›¾ç‰‡, ç›®å‰è¿™äº›å›¾ç‰‡æ— è®ºæ˜¯åœ¨æµè§ˆå™¨è¿˜æ˜¯åœ¨<code>Markdown</code>ç¼–è¾‘å™¨ä¸­éƒ½æ— æ³•æ˜¾ç¤º</p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240417181012252.png" alt="image-20240417181012252"></p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240417181029759.png" alt="image-20240417181029759"></p>
<p>è¿™å·²ç»ä¸æ˜¯ç®€å•çš„é˜²ç›—é“¾äº† åº”è¯¥æ˜¯æ–°æµªæœåŠ¡å™¨åšäº†æŸç§å±è”½å¤„ç†</p>
<h2 id="æ£€æµ‹æœåŠ¡å™¨å’Œé“¾æ¥æ˜¯å¦æ­£å¸¸"><a href="#æ£€æµ‹æœåŠ¡å™¨å’Œé“¾æ¥æ˜¯å¦æ­£å¸¸" class="headerlink" title="æ£€æµ‹æœåŠ¡å™¨å’Œé“¾æ¥æ˜¯å¦æ­£å¸¸"></a>æ£€æµ‹æœåŠ¡å™¨å’Œé“¾æ¥æ˜¯å¦æ­£å¸¸</h2><p>é¦–å…ˆæˆ‘ä»¬è¦ç¡®ä¿æ–°æµªæœåŠ¡å™¨ä¸­æœ‰è¯¥å›¾ç‰‡æ–‡ä»¶,  å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ£€æµ‹:</p>
<ol>
<li><p>ç”¨<code>VScode</code>ç¼–è¾‘å™¨ä¸­æ‰“å¼€æ–‡æ¡£ ç„¶åé¼ æ ‡åœç•™åœ¨å›¾ç‰‡é“¾æ¥ä¸Š, å¦‚æœèƒ½æ˜¾ç¤ºå›¾ç‰‡, è¯´æ˜è¯¥é“¾æ¥æœ‰æ•ˆ</p>
<p> <img src="https://gitee.com/songjianzaina/site_img/raw/master/img/2024-04-17%2018-02-18.2024-04-17%2018_02_58.gif" alt="2024-04-17 18-02-18.2024-04-17 18_02_58"></p>
</li>
<li><p>ç”¨<code>PostMan</code>æˆ–è€…<code>ApiPost</code>è¿›è¡Œè¯·æ±‚è®¿é—®<br> <img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240417181652619.png" alt="image-20240417181652619"></p>
</li>
<li><p>ä½¿ç”¨ä¸‹è½½å·¥å…·è¿›è¡Œä¸‹è½½</p>
<p> <img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240417181820927.png" alt="image-20240417181820927"></p>
</li>
</ol>
<p>å€¼å¾—åº†å¹¸çš„æ˜¯ æ–°æµªæœåŠ¡å™¨è¿˜æ²¡æœ‰æŒ‚ æˆ‘ä»¬è¿˜æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥å¯¹å›¾ç‰‡è¿›è¡Œè½¬ç§»å’Œå¤‡ä»½</p>
<h2 id="é˜²ç›—é“¾ä¸´æ—¶è§£å†³æ–¹æ³•"><a href="#é˜²ç›—é“¾ä¸´æ—¶è§£å†³æ–¹æ³•" class="headerlink" title="é˜²ç›—é“¾ä¸´æ—¶è§£å†³æ–¹æ³•"></a>é˜²ç›—é“¾ä¸´æ—¶è§£å†³æ–¹æ³•</h2><p>ä¸ºäº†ä½¿å›¾ç‰‡è¿…é€Ÿæ¢å¤è®¿é—®, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹ç¼“å­˜æœåŠ¡æ¥è§£å†³é˜²ç›—é“¾é—®é¢˜, æœ‰ä»¥ä¸‹å››ç§æ–¹å¼å¯è¡Œ:</p>
<ol>
<li><p><strong>WordPress</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://i0.wp.com/å›¾ç‰‡åœ°å€ï¼ˆå›¾ç‰‡åœ°å€è¦æ‰ https://ï¼‰</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Weserv.nl</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://images.weserv.nl/?url=å›¾ç‰‡åœ°å€</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ç™¾åº¦ 1ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://image.baidu.com/search/down?url=å›¾ç‰‡åœ°å€</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ç™¾åº¦ 2</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://gimg2.baidu.com/image_search/&amp;app=2020&amp;src=å›¾ç‰‡åœ°å€ï¼ˆå›¾ç‰‡åœ°å€è¦å»æ‰ https://ï¼‰</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>ä½¿ç”¨ç™¾åº¦çš„é€Ÿåº¦ç›¸å¯¹å¿«ä¸€äº›</p>
<h2 id="Wordpressæ‰¹é‡æ›¿æ¢"><a href="#Wordpressæ‰¹é‡æ›¿æ¢" class="headerlink" title="Wordpressæ‰¹é‡æ›¿æ¢"></a>Wordpressæ‰¹é‡æ›¿æ¢</h2><p>å¦‚æœä½ çš„<code>wordpress</code>åšå®¢å¤§é‡çš„å›¾ç‰‡éƒ½åœ¨æ–°æµªä¸­, é‚£ä¹ˆå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¿›è¡Œæ‰¹é‡æ›¿æ¢:</p>
<ol>
<li><p><strong>é™æ€æ›¿æ¢ ä¿®æ”¹æ•°æ®åº“</strong></p>
<p>ä¿®æ”¹æ•°æ®åº“ä¹‹å‰è®°å¾—å…ˆå¤‡ä»½æ•°æ®åº“ ä»¥é˜²æ­¢è¯¯æ“ä½œæ— æ³•è¿˜åŸ</p>
<p><code>sql</code>å‘½ä»¤å¦‚ä¸‹:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> wp_posts <span class="keyword">SET</span> post_content = <span class="keyword">REPLACE</span>( post_content,  <span class="string">'https://tvax1.sinaimg.cn/'</span>,  <span class="string">'https://image.baidu.com/search/down?url=https://tvax1.sinaimg.cn/'</span> )</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>åŠ¨æ€æ›¿æ¢ ä¿®æ”¹ä¸»é¢˜ä»£ç </strong></p>
<p>è¿›å…¥<code>wordpress</code>ä¸»é¢˜ç¼–è¾‘å™¨:</p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240417185327043.png" alt="image-20240417185327043"></p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°ä¸»é¢˜é¡µè„š<code>foot.php</code>ä¸­:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"> <span class="keyword">let</span> context = <span class="built_in">Array</span>.prototype.map.call(<span class="built_in">document</span>.images, (event) =&gt; &#123;</span></span><br><span class="line"><span class="actionscript">           event.src = event.src.replace(<span class="string">"tvax1.sinaimg.cn/"</span>, <span class="string">"image.baidu.com/search/down?url=https://tvax1.sinaimg.cn/"</span>)</span></span><br><span class="line">          </span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240417185632599.png" alt="image-20240417185632599"></p>
</li>
</ol>
<p>æ¨èä½¿ç”¨åŠ¨æ€çš„æ–¹å¼è‡ªåŠ¨æ‰¹é‡æ›¿æ¢, èƒ½å°†é™ä½æ•°æ®åº“æ“ä½œé£é™©, åˆæ–¹ä¾¿åæœŸå†æ¬¡æ›´æ”¹, åŠ¨æ€çš„æ–¹å¼å”¯ä¸€ä¸è¶³ä¹‹å¤„å°±æ˜¯å›¾ç‰‡åŠ è½½æœ‰å»¶è¿Ÿ</p>
<p>å¦‚æœä½ è¿½æ±‚åŠ è½½é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒ, é‚£ä¹ˆå»ºè®®é‡‡ç”¨é™æ€æ›¿æ¢çš„æ–¹å¼</p>
<h2 id="å›¾ç‰‡æ‰¹é‡å¤‡ä»½"><a href="#å›¾ç‰‡æ‰¹é‡å¤‡ä»½" class="headerlink" title="å›¾ç‰‡æ‰¹é‡å¤‡ä»½"></a>å›¾ç‰‡æ‰¹é‡å¤‡ä»½</h2><p>ä¸Šé¢è¿™ç§ä¸´æ—¶æ›¿æ¢æ–¹å¼å§‹ç»ˆä¸æ˜¯é•¿ä¹…ä¹‹è®¡, æˆ‘ä»¬éœ€è¦å°½å¿«å¯¹å›¾ç‰‡è¿›è¡Œå¤‡ä»½å’Œè¿ç§»  é˜²æ­¢æ–°æµªå›¾åºŠå“ªå¤©ä¸å†æä¾›æœåŠ¡äº†</p>
<p>æˆ‘ä¸ªäººçš„åšæ³•æ˜¯é€šè¿‡<code>python</code>æ‰¹é‡å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ° ç„¶åè¿›è¡Œå›¾åºŠæ›´æ¢, æ ¸å¿ƒä»£ç å¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="comment"># å½“å‰æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">current_path = os.path.abspath(__file__)</span><br><span class="line"><span class="comment"># çˆ¶ç›®å½•</span></span><br><span class="line">father_path = os.path.abspath(os.path.dirname(current_path) + os.path.sep + <span class="string">"."</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#----- ç”¨äºå›¾ç‰‡ä¸‹è½½------</span></span><br><span class="line">opener=urllib.request.build_opener()</span><br><span class="line">opener.addheaders=[(<span class="string">'User-Agent'</span>,<span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1941.0 Safari/537.36'</span>),(<span class="string">'Accept'</span>			, <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>),(</span><br><span class="line">        <span class="string">'Accept-Encoding'</span>	, <span class="string">'gzip,deflate,sdch'</span>),</span><br><span class="line">        (<span class="string">'Accept-Language'</span>	, <span class="string">'zh-CN,zh;q=0.8'</span>)]</span><br><span class="line">req=urllib.request</span><br><span class="line">req.install_opener(opener)</span><br><span class="line"><span class="comment">#----- ç”¨äºå›¾ç‰‡ä¸‹è½½------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å›¾ç‰‡è¾“å‡ºç›®å½•</span></span><br><span class="line">pic_dir = <span class="string">'img'</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pic_dir):</span><br><span class="line">    os.makedirs(pic_dir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†ç½‘ç»œå›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_img</span><span class="params">(url,dir,image_name)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        req.urlretrieve(url, dir+image_name)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡‡ç”¨åŸå›¾ç‰‡åœ°å€çš„åç§°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pic_name_by_url</span><span class="params">(url)</span>:</span></span><br><span class="line">     <span class="comment"># æˆ‘åªéœ€è¦æœ«å°¾xxxéƒ¨åˆ† ä½¿ç”¨æ­£åˆ™æ›¿æ¢</span></span><br><span class="line">    image_name = url.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> image_name</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">img2url</span><span class="params">(url)</span>:</span></span><br><span class="line">    		 fir=<span class="string">"https://cdn.jsdelivr.net/gh/xxx/xxx/img/"</span></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span> <span class="string">"sinaimg.cn"</span> <span class="keyword">in</span> url:</span><br><span class="line">        url=<span class="string">"https://image.baidu.com/search/down?url="</span>+url</span><br><span class="line">    new_name=get_pic_name_by_url(url)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        download_img(url,<span class="string">"&#123;parent&#125;/img/"</span>.format(parent=father_path),new_name)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">f"å›¾ç‰‡ä¸‹è½½å¼‚å¸¸: <span class="subst">&#123;e&#125;</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> url</span><br><span class="line">    <span class="keyword">return</span> fir+new_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ¯ç¯‡æ–‡ç« </span></span><br><span class="line"><span class="keyword">for</span> idx, post <span class="keyword">in</span> enumerate(posts):</span><br><span class="line">    content, lastmodifytime = post</span><br><span class="line"></span><br><span class="line">    d=pq(content)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> d(<span class="string">"img"</span>).items():</span><br><span class="line">        old_url=item.attr(<span class="string">"src"</span>)</span><br><span class="line">        <span class="comment"># å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°</span></span><br><span class="line">        new_url=img2url(old_url)</span><br><span class="line">        print(new_url)</span><br><span class="line">        <span class="comment">#æ›¿æ¢å›¾ç‰‡åœ°å€</span></span><br><span class="line">        item.attr(<span class="string">"src"</span>,new_url)</span><br></pre></td></tr></table></figure>

<p><strong>æœ¬æ–‡ä¸ºä½œè€…åŸåˆ› è½¬è½½æ—¶è¯·æ³¨æ˜å‡ºå¤„ è°¢è°¢</strong></p>
<p><img src="https://gitee.com/songjianzaina/SavePicGoPic/raw/master/img/20191119095516.png" alt></p>
<p><em><a href="https://code.newban.cn/">ä¹±ç ä¸‰åƒ â€“ ç‚¹æ»´ç§¯ç´¯ ,æ¬¢è¿æ¥åˆ°ä¹±ç ä¸‰åƒæŠ€æœ¯åšå®¢ç«™</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://code.newban.cn467.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="467.html" itemprop="url">å†…å®¹å¤šå¹³å°åˆ†å‘å·¥å…·æ±‡æ€»</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2024-04-16T15:14:19+08:00">
                2024-04-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ–‡ç« æ’°å†™ä¸€æ¬¡ åˆ°å¤„åˆ†å‘ æ— éœ€ç¹ççš„å¤åˆ¶ç²˜è´´ èŠ‚çœå¤§é‡çš„é‡å¤æœºæ¢°åŠ³åŠ¨åŠ› è¿½æ±‚æè‡´çš„è‡ªåŠ¨åŒ– ä¸€é”®åˆ†å‘å·¥å…· æ— ç–‘æ˜¯è§£å†³äº†å¾ˆå¤šåˆ›ä½œè€…çš„ç—›ç‚¹</p>
<p>æ¥ä¸‹æ¥ç»™å¤§å®¶æ±‡æ€»å‡ ä¸ªå¯ä¸€é”®åˆ†å‘çš„ç½‘ç«™</p>
<h2 id="ä¸€é”®åˆ†å‘å¹³å°"><a href="#ä¸€é”®åˆ†å‘å¹³å°" class="headerlink" title="ä¸€é”®åˆ†å‘å¹³å°"></a>ä¸€é”®åˆ†å‘å¹³å°</h2><ul>
<li><p><a href="https://mdnice.com/?platform=2" target="_blank" rel="noopener">mdnice</a></p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240418194825613.png" alt="image-20240418194825613"></p>
</li>
<li><p><a href="https://openwrite.cn/" target="_blank" rel="noopener">openwrite</a></p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240417225346730.png" alt="image-20240417225346730"></p>
</li>
</ul>
<p><strong>æœ¬æ–‡ä¸ºä½œè€…åŸåˆ› è½¬è½½æ—¶è¯·æ³¨æ˜å‡ºå¤„ è°¢è°¢</strong></p>
<p><img src="https://gitee.com/songjianzaina/SavePicGoPic/raw/master/img/20191119095516.png" alt></p>
<p><em><a href="https://code.newban.cn/">ä¹±ç ä¸‰åƒ â€“ ç‚¹æ»´ç§¯ç´¯ ,æ¬¢è¿æ¥åˆ°ä¹±ç ä¸‰åƒæŠ€æœ¯åšå®¢ç«™</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://code.newban.cn465.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="465.html" itemprop="url">ä½¿ç”¨python3å°†wordpressåšå®¢æ•°æ®è¿ç§»åˆ°hexo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2024-04-16T12:14:19+08:00">
                2024-04-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸ºäº†è¿½æ±‚ç½‘ç«™è®¿é—®çš„ç¨³å®šæ€§ å‡†å¤‡å°†<code>wordpress</code>åšå®¢è¿ç§»åˆ°<code>hexo</code>ä¸Š è€ƒè™‘åˆ°æ•°æ®é‡æ¯”è¾ƒå¤š æˆ‘ç›´æ¥å°†æ•°æ®åº“å¯¼å‡ºæˆå‹ç¼©åŒ… ç„¶åä¸‹è½½åˆ°æœ¬åœ°ç”µè„‘ ç„¶åä½¿ç”¨<code>python</code>æ‰¹é‡å°†é‡Œé¢çš„æ–‡ç« è½¬æˆ<code>markdown</code>æ ¼å¼çš„æ–‡æ¡£</p>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><ol>
<li><p>å¯¼å‡ºæ•°æ®åº“</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uç”¨æˆ·å -på¯†ç  æ•°æ®åº“å | gzip &gt; æ•°æ®åº“å.sql.gz</span><br></pre></td></tr></table></figure>
</li>
<li><p>å°†å¯¼å‡ºçš„æ•°æ®åº“æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ° ç„¶ååŒå‡»è§£å‹è¯¥æ•°æ®åº“</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r root@æœåŠ¡å™¨IP:åˆšå¯¼å‡ºçš„æ•°æ®åº“æ‰€åœ¨è·¯å¾„ æœ¬åœ°ç›®å½•</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ•°æ®åº“å¯¼å…¥è¿›æœ¬åœ°<code>mysql</code>ä¸­ æ–¹ä¾¿<code>python</code>è¿æ¥</p>
<p>é¦–å…ˆåˆ›å»ºæ–°æ•°æ®åº“:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;create database æ•°æ®åº“å;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°†<code>sql</code>æ–‡ä»¶å¯¼å…¥åˆ°è¯¥åº“ä¸­:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uç”¨æˆ·å -på¯†ç  æ•°æ®åº“å &lt; æ•°æ®åº“å.sql</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Pythonæ‰¹é‡è½¬æ¢"><a href="#Pythonæ‰¹é‡è½¬æ¢" class="headerlink" title="Pythonæ‰¹é‡è½¬æ¢"></a>Pythonæ‰¹é‡è½¬æ¢</h2><p><code>python</code>ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################</span></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line"><span class="comment">#  é“¾æ¥æœ¬åœ°mysqlæ•°æ®åº“å°†wordpressä¸­çš„æ–‡ç« æå–å‡ºæ¥å¹¶è½¬æˆhexoåšå®¢æ ¼å¼</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">##########################</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> markdownify <span class="keyword">import</span> markdownify <span class="keyword">as</span> md</span><br><span class="line"><span class="keyword">import</span> pymysql.cursors</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.setrecursionlimit(<span class="number">1000000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥æ•°æ®åº“</span></span><br><span class="line">conn = pymysql.Connect(</span><br><span class="line">    host=<span class="string">'127.0.0.1'</span>,</span><br><span class="line">    port=<span class="number">3306</span>,</span><br><span class="line">    user=<span class="string">'æ•°æ®åº“ç”¨æˆ·å'</span>,</span><br><span class="line">    passwd=<span class="string">'æ•°æ®åº“å¯†ç '</span>,</span><br><span class="line">    db=<span class="string">'wordpress_it'</span>,</span><br><span class="line">    charset=<span class="string">'utf8mb4'</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># è·å–æ¸¸æ ‡</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰æ–‡ç« </span></span><br><span class="line">cursor.execute(<span class="string">"SELECT post_title, post_content, post_date FROM wp_posts WHERE post_type='post'"</span>)</span><br><span class="line">posts = cursor.fetchall()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨</span></span><br><span class="line">output_dir = <span class="string">'hexo_posts'</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(output_dir):</span><br><span class="line">    os.makedirs(output_dir)</span><br><span class="line"></span><br><span class="line">tags=[<span class="string">"Android"</span>,<span class="string">"IOS"</span>,<span class="string">"æœåŠ¡å™¨"</span>,<span class="string">"Docker"</span>,<span class="string">"Mysql"</span>,<span class="string">"Flutter"</span>,<span class="string">"Java"</span>,<span class="string">"Hexo"</span>]</span><br><span class="line">postTag=<span class="string">"æŠ€æœ¯æ–‡ç« "</span> <span class="comment">#é»˜è®¤åˆ†ç±»ä¸º</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ¯ç¯‡æ–‡ç« </span></span><br><span class="line"><span class="keyword">for</span> idx, post <span class="keyword">in</span> enumerate(posts):</span><br><span class="line">    title, content,date = post</span><br><span class="line">    <span class="keyword">for</span> tag <span class="keyword">in</span> tags:</span><br><span class="line">        <span class="keyword">if</span> tag <span class="keyword">in</span> title:</span><br><span class="line">            postTag=tag</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†HTMLå†…å®¹è½¬æ¢ä¸ºMarkdown</span></span><br><span class="line">    markdown_content = md(content)</span><br><span class="line">    <span class="comment"># å†™å…¥Hexoæ ¼å¼çš„Markdownæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">with</span> open(os.path.join(output_dir, <span class="string">f"<span class="subst">&#123;idx+<span class="number">1</span>&#125;</span>.md"</span>), <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">"---\n"</span>)</span><br><span class="line">        f.write(<span class="string">f"title: <span class="subst">&#123;title&#125;</span>\n"</span>) <span class="comment"># å¦‚æœè¦åµŒå…¥å˜é‡ éœ€è¦åŠ f</span></span><br><span class="line">        f.write(<span class="string">f"date: <span class="subst">&#123;date&#125;</span>\n"</span>)  <span class="comment"># è¯·å°†æ—¥æœŸæ›¿æ¢ä¸ºå®é™…å‘å¸ƒæ—¥æœŸ</span></span><br><span class="line">        f.write(<span class="string">f"tags: <span class="subst">&#123;postTag&#125;</span>\n"</span>)</span><br><span class="line">        f.write(<span class="string">"---\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\n"</span>)</span><br><span class="line">        f.write(markdown_content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æ¸¸æ ‡å’Œè¿æ¥</span></span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<p>æƒ³è¦æ­£å¸¸è¿è¡Œè¯¥ä»£ç  éœ€è¦å®‰è£…<code>pymysql</code>å’Œ<code>markdownify</code>ä¸¤ä¸ªåº“:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install markdownify</span><br><span class="line">pip3 install pymysql</span><br></pre></td></tr></table></figure>

<p><strong>æœ¬æ–‡ä¸ºä½œè€…åŸåˆ› è½¬è½½æ—¶è¯·æ³¨æ˜å‡ºå¤„ è°¢è°¢</strong></p>
<p><img src="https://gitee.com/songjianzaina/SavePicGoPic/raw/master/img/20191119095516.png" alt></p>
<p><em><a href="https://code.newban.cn/">ä¹±ç ä¸‰åƒ â€“ ç‚¹æ»´ç§¯ç´¯ ,æ¬¢è¿æ¥åˆ°ä¹±ç ä¸‰åƒæŠ€æœ¯åšå®¢ç«™</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://code.newban.cn464.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="464.html" itemprop="url">ç¼–å†™ä¸€ä¸ªhexoæ’ä»¶ å®ç°ç»™æ–‡ç« ä¸­çš„å¤–éƒ¨è¶…é“¾æ¥å¢åŠ ä¸€ä¸ªä¸­é—´è·³è½¬è¯¢é—®é¡µé¢</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2024-04-16T10:14:19+08:00">
                2024-04-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>æˆ‘æœ¬æ¥æƒ³è®©AIç»™æˆ‘å†™ä¸€ä¸ª<code>hexo</code>æ’ä»¶ å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¯·å†™ä¸€ä¸ªhexoæ’ä»¶ è¦æ±‚åŠŸèƒ½å¦‚ä¸‹:</span><br><span class="line"></span><br><span class="line">1. åœ¨æ‰§è¡Œhexo -gæŒ‡ä»¤æ—¶è‡ªåŠ¨å°†æ–‡ç« ä¸­çš„éæœ¬ç«™åˆæ³•è¶…é“¾æ¥æå–æ›¿æ¢å‡ºæ¥ ä¸ºæ¯ä¸ªåˆæ³•çš„é“¾æ¥ç”Ÿæˆç‹¬ç«‹çš„è·³è½¬é¡µé¢  ç‹¬ç«‹é¡µé¢çš„åœ°å€å’Œé“¾æ¥å½¢æˆå›ºå®šçš„å¯¹åº”å…³ç³»  ä¸ä¼šå› ä¸ºæ–°å¢æ–‡ç« è€Œå‘ç”Ÿå¯¹åº”é“¾æ¥æ”¹å˜çš„é—®é¢˜</span><br><span class="line">2. å½“ç”¨æˆ·æµè§ˆåšå®¢æ—¶ç‚¹å‡»è¶…é“¾æ¥ä¼šè·³è½¬åˆ°ä¸€ä¸ªå•ç‹¬çš„ç½‘é¡µ åœ¨è¿™ä¸ªç½‘é¡µä¸­æ˜¾ç¤ºæ–‡å­—å’Œè¯¥é“¾æ¥åœ°å€å¹¶è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦è·³è½¬åˆ°è¯¥é“¾æ¥  å½“ç”¨æˆ·ç‚¹å‡»æ–‡å­—ä¸‹æ–¹çš„è·³è½¬æŒ‰é’®åˆ™è‡ªåŠ¨è·³è½¬åˆ°è¯¥é“¾æ¥  </span><br><span class="line">3. æ–‡ç« ä¸­çš„é“¾æ¥åº”è¯¥æ›¿æ¢æˆå¯¹åº”å·²ç»ç”Ÿæˆçš„è·³è½¬é¡µé¢çš„é“¾æ¥ </span><br><span class="line">4. è¦æ±‚èƒ½åœ¨`config`æ–‡ä»¶ä¸­è‡ªå®šä¹‰éœ€è¦è¿›è¡Œæ’é™¤çš„åŸŸå ä¸å¯¹æ’é™¤çš„åŸŸåä¸‹çš„æ‰€æœ‰é“¾æ¥è¿›è¡Œè·³è½¬é¡µé¢çš„ç”Ÿæˆ ä¿ç•™åŸå§‹çš„ç›´æ¥è·³è½¬å³å¯ </span><br><span class="line">5. åœ¨`config`æ–‡ä»¶ä¸­å¢åŠ æ’ä»¶çš„å¼€å¯å¼€å…³ </span><br><span class="line">6. éœ€è¦è¿‡æ»¤æ‰éåˆæ³•çš„è¶…é“¾æ¥ éåˆæ³•çš„é“¾æ¥ä¸åšå¤„ç†</span><br><span class="line">7. è·³è½¬é¡µé¢çš„UIå¸Œæœ›èƒ½ç¾è§‚ä¸€äº› å†…å®¹å±…ä¸­æ˜¾ç¤º </span><br><span class="line"></span><br><span class="line">è¯·ç»™å‡ºæ’ä»¶çš„å®Œæ•´ä»£ç </span><br></pre></td></tr></table></figure>

<p>ç„¶å<code>AI</code>ç»™æˆ‘çš„ç­”æ¡ˆæ˜¯:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ»¡è¶³æ‚¨éœ€æ±‚çš„Hexoæ’ä»¶çš„å®Œæ•´ä»£ç ï¼š</span><br><span class="line"></span><br><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">const &#123; promisify &#125; = require(&apos;util&apos;);</span><br><span class="line">const &#123; URL &#125; = require(&apos;url&apos;);</span><br><span class="line"></span><br><span class="line">const readFile = promisify(fs.readFile);</span><br><span class="line">const writeFile = promisify(fs.writeFile);</span><br><span class="line"></span><br><span class="line">const config = hexo.config.external_link_redirect || &#123;&#125;;</span><br><span class="line">const excludedDomains = config.excluded_domains || [];</span><br><span class="line">const redirectPageDir = path.join(hexo.public_dir, &apos;redirect_pages&apos;);</span><br><span class="line">const redirectPageTemplate = `</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;Redirect Page&lt;/title&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">      font-family: Arial, sans-serif;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line">    .container &#123;</span><br><span class="line">      margin-top: 100px;</span><br><span class="line">    &#125;</span><br><span class="line">    .link &#123;</span><br><span class="line">      font-size: 18px;</span><br><span class="line">      font-weight: bold;</span><br><span class="line">    &#125;</span><br><span class="line">    .button &#123;</span><br><span class="line">      padding: 10px 20px;</span><br><span class="line">      background-color: #007bff;</span><br><span class="line">      color: #fff;</span><br><span class="line">      border: none;</span><br><span class="line">      border-radius: 5px;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">      text-decoration: none;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;p class=&quot;link&quot;&gt;%LINK%&lt;/p&gt;</span><br><span class="line">    &lt;button class=&quot;button&quot; onclick=&quot;redirectToLink()&quot;&gt;Go to Link&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    function redirectToLink() &#123;</span><br><span class="line">      window.location.href = &apos;%URL%&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line">hexo.extend.filter.register(&apos;before_generate&apos;, async function () &#123;</span><br><span class="line">  if (!config.enable) &#123;</span><br><span class="line">    console.log(&apos;External link redirect plugin is disabled.&apos;);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  await createRedirectPages();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">async function createRedirectPages() &#123;</span><br><span class="line">  const posts = hexo.locals.get(&apos;posts&apos;);</span><br><span class="line">  if (!posts || !posts.length) &#123;</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  for (const post of posts.data) &#123;</span><br><span class="line">    const content = post.content;</span><br><span class="line">    const updatedContent = await processContent(content);</span><br><span class="line">    post.content = updatedContent;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function processContent(content) &#123;</span><br><span class="line">  const updatedContent = content.replace(/&lt;a href=&quot;([^&quot;]+)&quot;[^&gt;]*&gt;(.*?)&lt;\/a&gt;/gi, async (match, url, text) =&gt; &#123;</span><br><span class="line">    if (!isLinkValid(url)) &#123;</span><br><span class="line">      return match; // Skip invalid links</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const redirectPagePath = await generateRedirectPage(url);</span><br><span class="line">    const redirectLink = `&lt;a href=&quot;$&#123;redirectPagePath&#125;&quot;&gt;$&#123;text&#125;&lt;/a&gt;`;</span><br><span class="line">    return redirectLink;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return updatedContent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function isLinkValid(url) &#123;</span><br><span class="line">  if (!url || typeof url !== &apos;string&apos;) &#123;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const parsedUrl = new URL(url);</span><br><span class="line">  const domain = parsedUrl.hostname.replace(&apos;www.&apos;, &apos;&apos;);</span><br><span class="line">  return !excludedDomains.includes(domain);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function generateRedirectPage(url) &#123;</span><br><span class="line">  const redirectUrl = new URL(url);</span><br><span class="line">  const domain = redirectUrl.hostname.replace(&apos;www.&apos;, &apos;&apos;);</span><br><span class="line">  const redirectPagePath = path.join(redirectPageDir, `$&#123;domain&#125;_$&#123;Date.now()&#125;.html`);</span><br><span class="line">  const pageContent = redirectPageTemplate.replace(&apos;%LINK%&apos;, url).replace(&apos;%URL%&apos;, url);</span><br><span class="line"></span><br><span class="line">  await writeFile(redirectPagePath, pageContent);</span><br><span class="line">  return redirectPagePath.replace(hexo.public_dir, &apos;&apos;);</span><br><span class="line">&#125;</span><br><span class="line">åœ¨è¿™ä¸ªæ’ä»¶ä¸­ï¼Œæˆ‘ä»¬åšäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</span><br><span class="line"></span><br><span class="line">åœ¨æ‰§è¡Œhexo -gæŒ‡ä»¤ä¹‹å‰ï¼Œé€šè¿‡before_generateè¿‡æ»¤å™¨æ¥è‡ªåŠ¨ç”Ÿæˆè·³è½¬é¡µé¢ã€‚</span><br><span class="line">é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼éå†æ–‡ç« å†…å®¹ï¼Œæ‰¾åˆ°æ‰€æœ‰è¶…é“¾æ¥ï¼Œå¹¶æ£€æŸ¥é“¾æ¥æ˜¯å¦æœ‰æ•ˆã€‚</span><br><span class="line">å¯¹äºæœ‰æ•ˆçš„é“¾æ¥ï¼Œåˆ›å»ºä¸€ä¸ªè·³è½¬é¡µé¢ï¼Œå¹¶å°†åŸå§‹é“¾æ¥æ›¿æ¢ä¸ºè·³è½¬é¡µé¢çš„é“¾æ¥ã€‚</span><br><span class="line">ç”Ÿæˆçš„è·³è½¬é¡µé¢æ˜¯ä¸€ä¸ªHTMLæ–‡ä»¶ï¼ŒåŒ…å«è·³è½¬é“¾æ¥å’Œä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»æŒ‰é’®å¯ä»¥è·³è½¬åˆ°åŸå§‹é“¾æ¥ã€‚</span><br><span class="line">ç”¨æˆ·å¯ä»¥åœ¨Hexoé…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ’ä»¶çš„å¼€å¯çŠ¶æ€ã€éœ€è¦æ’é™¤çš„åŸŸåä»¥åŠè·³è½¬é¡µé¢æ¨¡æ¿ã€‚</span><br><span class="line">æœ€ç»ˆç”Ÿæˆçš„è·³è½¬é¡µé¢ä¿å­˜åœ¨public/redirect_pagesç›®å½•ä¸‹ï¼Œæ¯ä¸ªé¡µé¢éƒ½æœ‰å›ºå®šçš„å¯¹åº”å…³ç³»ï¼Œä¸ä¼šå› ä¸ºæ–°å¢æ–‡ç« è€Œæ”¹å˜é“¾æ¥ã€‚</span><br></pre></td></tr></table></figure>

<p>çœ‹äº†ä¸€ä¸‹AIç»™æˆ‘å†™çš„ä»£ç , å¯ä»¥è¯´æ˜¯ç§€çš„æˆ‘å¤´ç–¼, ä»£ç å¯è¯»æ€§å®åœ¨å¤ªå·®äº†, éš¾é“æ˜¯æˆ‘é—®çš„æ–¹å¼ä¸å¯¹?ğŸ¤”</p>
<p>ç”±äº<code>ChatGPT</code>å…è´¹æ¬¡æ•°æœ‰é™ æˆ‘ä¹Ÿæ‡’å¾—å»æœå¯»å…è´¹çš„<code>AIChat</code>,  å¹²è„†å°±è‡ªå·±æ‰‹åŠ¨å†™ä¸€ä¸ªå§</p>
<p>æœ€åè°ƒè¯•å®Œæˆåçš„æ’ä»¶ä»£ç å¦‚ä¸‹:</p>
<h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; log &#125; = <span class="built_in">require</span>(<span class="string">'console'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DEFAULT_EXCLUDE_DOMAINS = [<span class="string">'example.com'</span>]; <span class="comment">// é»˜è®¤æ’é™¤çš„åŸŸååˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">hexo.extend.filter.register(<span class="string">'before_generate'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> config = hexo.config.external_links || &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> excludeDomains = config.exclude_domains || DEFAULT_EXCLUDE_DOMAINS;</span><br><span class="line">    <span class="keyword">if</span> (!config.enable) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'å…³é—­external_linksæ’ä»¶'</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    hexo.extend.generator.register(<span class="string">'external_links'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">locals</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> posts = locals.posts;</span><br><span class="line">        <span class="keyword">const</span> author = hexo.config.author;</span><br><span class="line">        <span class="keyword">const</span> outputDir = hexo.config.external_links_output || <span class="string">'external_links'</span>;</span><br><span class="line">        <span class="keyword">const</span> linkMap = <span class="keyword">new</span> <span class="built_in">Map</span>(); <span class="comment">// å­˜å‚¨é“¾æ¥å’Œå…¶å¯¹åº”çš„å“ˆå¸Œå€¼çš„æ˜ å°„</span></span><br><span class="line"></span><br><span class="line">        posts.forEach(<span class="function"><span class="params">post</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> $ = cheerio.load(post.content);</span><br><span class="line">            $(<span class="string">'a'</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">const</span> href = filterUrl($(<span class="keyword">this</span>).attr(<span class="string">'href'</span>));</span><br><span class="line">                <span class="keyword">const</span> hostname = getHostname(href);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (hostname!=<span class="string">""</span>&amp;&amp;!excludeDomains.includes(hostname)) &#123;</span><br><span class="line">                    <span class="keyword">const</span> hash = generateHash(href);</span><br><span class="line">                    linkMap.set(href, hash); <span class="comment">// å­˜å‚¨é“¾æ¥å’Œå“ˆå¸Œå€¼çš„æ˜ å°„å…³ç³»</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//æ›¿æ¢æ–‡ç« ä¸­çš„åŸå§‹é“¾æ¥</span></span><br><span class="line">                    <span class="keyword">const</span> newHref = <span class="string">`/<span class="subst">$&#123;outputDir&#125;</span>/<span class="subst">$&#123;hash&#125;</span>.html`</span>;</span><br><span class="line">                    $(<span class="keyword">this</span>).attr(<span class="string">'href'</span>, newHref);</span><br><span class="line">                    $(<span class="keyword">this</span>).attr(<span class="string">'target'</span>, <span class="string">"blank"</span>);<span class="comment">//åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€è¶…é“¾æ¥</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            post.content = $.html();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> outputPath = path.join(hexo.public_dir, outputDir);</span><br><span class="line">        <span class="keyword">if</span> (!fs.existsSync(outputPath)) &#123;</span><br><span class="line">            fs.mkdirSync(outputPath);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”Ÿæˆæ¯ä¸ªé“¾æ¥å¯¹åº”çš„é¡µé¢</span></span><br><span class="line">        linkMap.forEach(<span class="function">(<span class="params">hash, href</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> htmlContent = generateLinkPage(href, hash,author);</span><br><span class="line">            <span class="keyword">const</span> outputFile = path.join(outputPath, <span class="string">`<span class="subst">$&#123;hash&#125;</span>.html`</span>);</span><br><span class="line">            fs.writeFileSync(outputFile, htmlContent);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateLinkPage</span>(<span class="params">href, hash,author</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> html = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html lang="en"&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;meta charset="UTF-8"&gt;</span></span><br><span class="line"><span class="string">            &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;è®¿é—®å¤–éƒ¨ç½‘ç«™-&#123;author&#125;&lt;/title&gt;</span></span><br><span class="line"><span class="string">            &lt;style&gt;</span></span><br><span class="line"><span class="string">                body &#123;</span></span><br><span class="line"><span class="string">                    margin: 20px;</span></span><br><span class="line"><span class="string">                    padding-top: 100px;</span></span><br><span class="line"><span class="string">                    color: #222;</span></span><br><span class="line"><span class="string">                    font-size: 13px;</span></span><br><span class="line"><span class="string">                    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="string">                    line-height: 1.5;</span></span><br><span class="line"><span class="string">                    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                .wrapper &#123;</span></span><br><span class="line"><span class="string">                    margin: auto;</span></span><br><span class="line"><span class="string">                    padding-left: 30px;</span></span><br><span class="line"><span class="string">                    padding-right: 30px;</span></span><br><span class="line"><span class="string">                    max-width: 540px;</span></span><br><span class="line"><span class="string"> 									  padding-top: 25px;</span></span><br><span class="line"><span class="string">                    padding-bottom: 25px;</span></span><br><span class="line"><span class="string">                    background-color: #f7f7f7;</span></span><br><span class="line"><span class="string">                    border: 1px solid #babbbc;</span></span><br><span class="line"><span class="string">                    border-radius: 5px;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">             </span></span><br><span class="line"><span class="string">              </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">                .button &#123;</span></span><br><span class="line"><span class="string">                    padding: 0;</span></span><br><span class="line"><span class="string">                    font-family: inherit;</span></span><br><span class="line"><span class="string">                    background: none;</span></span><br><span class="line"><span class="string">                    border: none;</span></span><br><span class="line"><span class="string">                    outline: none;</span></span><br><span class="line"><span class="string">                    cursor: pointer;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                .button:hover &#123;</span></span><br><span class="line"><span class="string">                    background-color: #0070cd;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                a&#123;</span></span><br><span class="line"><span class="string">                    text-decoration: none</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">                .button:active &#123;</span></span><br><span class="line"><span class="string">                    background-color: #0077d9;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">          </span></span><br><span class="line"><span class="string">                .link &#123;</span></span><br><span class="line"><span class="string">                    margin-bottom: 10px;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              </span></span><br><span class="line"><span class="string">                .button &#123;</span></span><br><span class="line"><span class="string">                    display: inline-block;</span></span><br><span class="line"><span class="string">                    padding: 10px 16px;</span></span><br><span class="line"><span class="string">                    color: #fff;</span></span><br><span class="line"><span class="string">                    font-size: 14px;</span></span><br><span class="line"><span class="string">                    line-height: 1;</span></span><br><span class="line"><span class="string">                    background-color: #0077d9;</span></span><br><span class="line"><span class="string">                    border-radius: 3px;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                .actions &#123;</span></span><br><span class="line"><span class="string">                    margin-top: 15px;</span></span><br><span class="line"><span class="string">                    padding-top: 30px;</span></span><br><span class="line"><span class="string">                    text-align: right;</span></span><br><span class="line"><span class="string">                    border-top: 1px solid #d8d8d8;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &lt;/style&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">            &lt;div class="wrapper"&gt;</span></span><br><span class="line"><span class="string">                &lt;div class="content"&gt;</span></span><br><span class="line"><span class="string">                    &lt;h1&gt;å³å°†ç¦»å¼€<span class="subst">$&#123;author&#125;</span>&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                    &lt;p class="info"&gt;æ‚¨å³å°†ç¦»å¼€<span class="subst">$&#123;author&#125;</span>ï¼Œå‰å¾€å¤–éƒ¨ç½‘ç«™ã€‚&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;p class="link"&gt;<span class="subst">$&#123;href&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;div class="actions"&gt;</span></span><br><span class="line"><span class="string">                    &lt;a class="button" href="<span class="subst">$&#123;href&#125;</span>" one-link-mark="yes"&gt;ç»§ç»­è®¿é—®&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    <span class="keyword">return</span> html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHostname</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> URL(url).hostname;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterUrl</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> urlRegex = <span class="regexp">/http[s]?:\/\/[\u4e00-\u9fa5\w.-\/:]+[\u4e00-\u9fa5\w.?&amp;\/=-]+/g</span>;</span><br><span class="line">    <span class="keyword">const</span> match = urlRegex.exec(url);</span><br><span class="line">    <span class="keyword">return</span> match ? match[<span class="number">0</span>] : <span class="string">''</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateHash</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> crypto.createHash(<span class="string">'md5'</span>).update(data).digest(<span class="string">'hex'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨æ–¹æ³•:</strong></p>
<p>åœ¨<code>script</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>js</code>æ–‡ä»¶,  æ³¨æ„åç§°ä¸è¦ä½¿ç”¨<code>index.js</code>, å°†ä¸Šé¢ä»£ç ç²˜è´´è¿‡å», ç„¶ååœ¨<code>config</code>é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¾“å‡ºçš„ç›®å½•ä»¥åŠéœ€è¦è¿‡æ»¤çš„åŸŸå å¦‚ä¸‹:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#éœ€è¦æ’é™¤çš„åŸŸå ä»¥åŠæ˜¯å¦å¼€å¯è¯¥æ’ä»¶</span></span><br><span class="line"><span class="attr">external_links:</span></span><br><span class="line"><span class="attr">  exclude_domains:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'acg.newban.cn'</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'newban.cn'</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'code.newban.cn'</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'audio.newban.cn'</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#è¾“å‡ºç›®å½•</span></span><br><span class="line"><span class="attr">external_links_output:</span> <span class="string">external_links</span></span><br></pre></td></tr></table></figure>

<h2 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h2><p>æ¨¡ä»¿çš„çŸ¥ä¹æ•ˆæœ:</p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240416141911249.png" alt="image-20240416141911249"></p>
<p><strong>æœ¬æ–‡ä¸ºä½œè€…åŸåˆ› è½¬è½½æ—¶è¯·æ³¨æ˜å‡ºå¤„ è°¢è°¢</strong></p>
<p><img src="https://gitee.com/songjianzaina/SavePicGoPic/raw/master/img/20191119095516.png" alt></p>
<p><em><a href="https://code.newban.cn/">ä¹±ç ä¸‰åƒ â€“ ç‚¹æ»´ç§¯ç´¯ ,æ¬¢è¿æ¥åˆ°ä¹±ç ä¸‰åƒæŠ€æœ¯åšå®¢ç«™</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://code.newban.cn463.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="463.html" itemprop="url">æ•°æ®åº“å¸¸ç”¨æ“ä½œæŒ‡ä»¤</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2024-04-15T10:14:19+08:00">
                2024-04-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ•°æ®åº“æ“ä½œæŒ‡ä»¤<em>î›ª</em>æ¶µç›–äº†åˆ›å»ºã€æŸ¥è¯¢ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®åº“åŠè¡¨çš„è¿‡ç¨‹ï¼Œä»¥åŠå¦‚ä½•åœ¨è¿™äº›æ•°æ®åº“å’Œè¡¨ä¸­è¿›è¡Œæ•°æ®æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ•°æ®åº“æ“ä½œæŒ‡ä»¤ï¼š</p>
<h2 id="æŒ‡ä»¤"><a href="#æŒ‡ä»¤" class="headerlink" title="æŒ‡ä»¤"></a>æŒ‡ä»¤</h2><h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> æ•°æ®åº“å;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤æ•°æ®åº“"><a href="#åˆ é™¤æ•°æ®åº“" class="headerlink" title="åˆ é™¤æ•°æ®åº“"></a>åˆ é™¤æ•°æ®åº“</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> æ•°æ®åº“å;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> è¡¨å (åˆ—å æ•°æ®ç±»å‹);</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤è¡¨"><a href="#åˆ é™¤è¡¨" class="headerlink" title="åˆ é™¤è¡¨"></a>åˆ é™¤è¡¨</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> è¡¨å;</span><br></pre></td></tr></table></figure>

<h3 id="æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“"><a href="#æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“" class="headerlink" title="æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“"></a>æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure>

<h3 id="è¿›å…¥æ•°æ®åº“"><a href="#è¿›å…¥æ•°æ®åº“" class="headerlink" title="è¿›å…¥æ•°æ®åº“"></a>è¿›å…¥æ•°æ®åº“</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> æ•°æ®åº“å;</span><br></pre></td></tr></table></figure>

<h3 id="æ˜¾ç¤ºæ‰€æœ‰è¡¨"><a href="#æ˜¾ç¤ºæ‰€æœ‰è¡¨" class="headerlink" title="æ˜¾ç¤ºæ‰€æœ‰è¡¨"></a>æ˜¾ç¤ºæ‰€æœ‰è¡¨</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure>

<h3 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> è¡¨å <span class="keyword">values</span>(å€¼<span class="number">1</span>,å€¼<span class="number">2</span>,...);</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹æ•°æ®"><a href="#ä¿®æ”¹æ•°æ®" class="headerlink" title="ä¿®æ”¹æ•°æ®"></a>ä¿®æ”¹æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> è¡¨å <span class="keyword">set</span> å­—æ®µ=æ–°å€¼ <span class="keyword">where</span> æ¡ä»¶;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> è¡¨å <span class="keyword">where</span> æ¡ä»¶;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹è¡¨å"><a href="#ä¿®æ”¹è¡¨å" class="headerlink" title="ä¿®æ”¹è¡¨å"></a>ä¿®æ”¹è¡¨å</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> æ—§è¡¨å <span class="keyword">rename</span> <span class="keyword">to</span> æ–°è¡¨å;</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹è¡¨æ‰€æœ‰çš„å­—æ®µ"><a href="#æŸ¥çœ‹è¡¨æ‰€æœ‰çš„å­—æ®µ" class="headerlink" title="æŸ¥çœ‹è¡¨æ‰€æœ‰çš„å­—æ®µ"></a>æŸ¥çœ‹è¡¨æ‰€æœ‰çš„å­—æ®µ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">describe</span> è¡¨å</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> è¡¨å</span><br></pre></td></tr></table></figure>

<h3 id="æ·»åŠ å­—æ®µ"><a href="#æ·»åŠ å­—æ®µ" class="headerlink" title="æ·»åŠ å­—æ®µ"></a>æ·»åŠ å­—æ®µ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">add</span> å­—æ®µå æ•°æ®ç±»å‹;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹å­—æ®µ"><a href="#ä¿®æ”¹å­—æ®µ" class="headerlink" title="ä¿®æ”¹å­—æ®µ"></a>ä¿®æ”¹å­—æ®µ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">modify</span> å­—æ®µå æ–°æ•°æ®ç±»å‹;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤å­—æ®µ"><a href="#åˆ é™¤å­—æ®µ" class="headerlink" title="åˆ é™¤å­—æ®µ"></a>åˆ é™¤å­—æ®µ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">drop</span> å­—æ®µå;</span><br></pre></td></tr></table></figure>

<p>è¿™äº›æŒ‡ä»¤æä¾›äº†å¯¹æ•°æ®åº“å’Œè¡¨çš„åŸºæœ¬æ“ä½œï¼ŒåŒ…æ‹¬åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤å’ŒæŸ¥è¯¢æ•°æ® æ ¹æ®å…·ä½“éœ€æ±‚ï¼Œå¯ä»¥ç»„åˆä½¿ç”¨è¿™äº›æŒ‡ä»¤æ¥å®Œæˆæ›´å¤æ‚çš„æ•°æ®åº“ç®¡ç†ä»»åŠ¡</p>
<p><strong>æœ¬æ–‡ä¸ºä½œè€…åŸåˆ› è½¬è½½æ—¶è¯·æ³¨æ˜å‡ºå¤„ è°¢è°¢</strong></p>
<p><img src="https://gitee.com/songjianzaina/SavePicGoPic/raw/master/img/20191119095516.png" alt></p>
<p><em><a href="https://code.newban.cn/">ä¹±ç ä¸‰åƒ â€“ ç‚¹æ»´ç§¯ç´¯ ,æ¬¢è¿æ¥åˆ°ä¹±ç ä¸‰åƒæŠ€æœ¯åšå®¢ç«™</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://code.newban.cn460.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="460.html" itemprop="url">Macå¹³å°å¦‚ä½•ä¸‹è½½ffmpegå¹¶å¯¹m3u8è§†é¢‘è¿›è¡Œä¸‹è½½è½¬æ¢æˆMP4</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2024-04-13T10:14:19+08:00">
                2024-04-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ffmpegå®‰è£…"><a href="#ffmpegå®‰è£…" class="headerlink" title="ffmpegå®‰è£…"></a>ffmpegå®‰è£…</h2><p>åœ¨Macå¹³å°ä¸Š æœ¬äººå¤šæ¬¡ä½¿ç”¨<code>brew</code>å·¥å…·è¿›è¡Œ<code>ffmpeg</code>å®‰è£…éƒ½æœªæˆåŠŸ</p>
<p>äºæ˜¯å†³å®šç›´æ¥å»<code>ffmpeg</code>å®˜ç½‘ä¸‹è½½æ‰§è¡ŒåŒ…</p>
<p><a href="http://www.ffmpeg.org/download.html" target="_blank" rel="noopener">ç‚¹å‡»è¿›å…¥å®˜ç½‘</a></p>
<p>ç”±äºæ˜¯å›½å¤–çš„ç½‘ç«™ ä¸‹è½½é€Ÿåº¦ä¼šç›¸å¯¹è¾ƒæ…¢ æ–‡æœ«å·²ç»ç»™å¤§å®¶å‡†å¤‡äº†ç½‘ç›˜ä¸‹è½½é“¾æ¥</p>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©<code>Mac</code> :</p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240413173518406.png" alt="image-20240413173518406"></p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240413173539785.png" alt="image-20240413173539785"></p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240413173602675.png" alt="image-20240413173602675"></p>
<p>å°†æ‰§è¡Œå‹ç¼©åŒ…è§£å‹åå¾—åˆ°ä¸€ä¸ªç‹¬ç«‹çš„<code>ffmpeg</code>æ‰§è¡Œæ–‡ä»¶:</p>
<p><img src="https://gitee.com/songjianzaina/site_img/raw/master/img/image-20240413173929604.png" alt="image-20240413173929604"></p>
<p>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬æ¥ä¸‹æ¥çš„ä½¿ç”¨ éœ€è¦å¯¹å…¶è¿›è¡Œç¯å¢ƒå˜é‡çš„é…ç½®:</p>
<ol>
<li><p>åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ æ‰“å¼€ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼š</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨è¯¥æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="string">"/path/to/ffmpeg:<span class="variable">$PATH</span>"</span></span><br></pre></td></tr></table></figure>

<p> æ³¨æ„: è¿™é‡Œéœ€è¦å°† <code>/path/to/ffmpeg</code> æ›¿æ¢ä¸ºä½ çš„<code>ffmpeg</code>æ‰€åœ¨è·¯å¾„</p>
</li>
</ol>
<ol start="3">
<li><p>ä½¿ç”¨<code>source</code>å‘½ä»¤ä½¿æ–°çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ</p>
<p>åœ¨ä»»æ„ä¸€ä¸ªéffmpegæ‰€åœ¨ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤, å¦‚æœæ­£å¸¸æ‰“å°å†…å®¹ åˆ™ä»£è¡¨é…ç½®æˆåŠŸ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -version</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="ä¸‹è½½m3u8è§†é¢‘å¹¶è½¬æ¢æˆmp4"><a href="#ä¸‹è½½m3u8è§†é¢‘å¹¶è½¬æ¢æˆmp4" class="headerlink" title="ä¸‹è½½m3u8è§†é¢‘å¹¶è½¬æ¢æˆmp4"></a>ä¸‹è½½m3u8è§†é¢‘å¹¶è½¬æ¢æˆmp4</h2><p><code>ffmpeg</code>æ”¯æŒç›´æ¥è®¿é—®<code>m3u8</code>é“¾æ¥å¹¶å°†å…¶å†…å®¹è½¬æˆmp4æ ¼å¼, æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i &#123;m3u8é“¾æ¥&#125; -c copy -bsf:a aac_adtstoasc &#123;æ–‡ä»¶å&#125;.mp4</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„è¯¥<code>ffmpeg</code>æŒ‡ä»¤ä¹Ÿé€‚ç”¨äºç›´æ’­æµçš„ä¸‹è½½å’Œè½¬æ¢ æ¯”å¦‚<code>http://xxx.flv</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i &#123;ç›´æ’­é“¾æ¥&#125; -c copy -bsf:a aac_adtstoasc &#123;æ–‡ä»¶å&#125;.mp4</span><br></pre></td></tr></table></figure>

<h2 id="ffmpegå›½å†…ä¸‹è½½"><a href="#ffmpegå›½å†…ä¸‹è½½" class="headerlink" title="ffmpegå›½å†…ä¸‹è½½"></a>ffmpegå›½å†…ä¸‹è½½</h2><p><a href="https://url97.ctfile.com/d/21042697-59243365-19e46d?p=312306" target="_blank" rel="noopener">ç½‘ç›˜ä¸‹è½½</a> (è®¿é—®å¯†ç : 312306)</p>
<p><strong>æœ¬æ–‡ä¸ºä½œè€…åŸåˆ› è½¬è½½æ—¶è¯·æ³¨æ˜å‡ºå¤„ è°¢è°¢</strong></p>
<p><img src="https://gitee.com/songjianzaina/SavePicGoPic/raw/master/img/20191119095516.png" alt></p>
<p><em><a href="https://code.newban.cn/">ä¹±ç ä¸‰åƒ â€“ ç‚¹æ»´ç§¯ç´¯ ,æ¬¢è¿æ¥åˆ°ä¹±ç ä¸‰åƒæŠ€æœ¯åšå®¢ç«™</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://code.newban.cn461.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="461.html" itemprop="url">ä½¿ç”¨ffmpegå°†æœ¬åœ°çš„flvè§†é¢‘å‹åˆ¶è½¬æ¢æˆå°ä½“ç§¯çš„MP4</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2024-04-13T10:14:19+08:00">
                2024-04-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…³äº<code>ffmpeg</code>çš„ä¸‹è½½, å¯æŸ¥é˜…ä¸Šä¸€ç¯‡æ–‡ç« ã€Š<a href="https://code.newban.cn/460.html">Macå¹³å°å¦‚ä½•ä¸‹è½½ffmpegå¹¶å¯¹m3u8è§†é¢‘è¿›è¡Œä¸‹è½½è½¬æ¢æˆMP4</a>ã€‹</p>
<p>æœ¬æ–‡å°†ç»™å¤§å®¶ä»‹ç»å¦‚ä½•ä½¿ç”¨<code>ffmpeg</code>å°†æœ¬åœ°çš„<code>flv</code>è§†é¢‘å‹åˆ¶è½¬æ¢æˆå°ä½“ç§¯çš„<code>MP4</code></p>
<h2 id="æ ¼å¼è½¬æ¢"><a href="#æ ¼å¼è½¬æ¢" class="headerlink" title="æ ¼å¼è½¬æ¢"></a>æ ¼å¼è½¬æ¢</h2><p>å¦‚æœåªæ˜¯å•çº¯çš„è¿›è¡Œæ ¼å¼è½¬æ¢ å¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ¥å®ç°:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.flv -vcodec copy -acodec copy output.mp4</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹å¼é€šå¸¸ä½“ç§¯ä¸ä¼šæœ‰å¤ªå¤§çš„æ”¹å˜ </p>
<h2 id="è½¬æ¢æ ¼å¼å¹¶å‹ç¼©è§†é¢‘ä½“ç§¯"><a href="#è½¬æ¢æ ¼å¼å¹¶å‹ç¼©è§†é¢‘ä½“ç§¯" class="headerlink" title="è½¬æ¢æ ¼å¼å¹¶å‹ç¼©è§†é¢‘ä½“ç§¯"></a>è½¬æ¢æ ¼å¼å¹¶å‹ç¼©è§†é¢‘ä½“ç§¯</h2><p>å¦‚æœéœ€è¦å°†è§†é¢‘è¿›è¡Œå‹ç¼© ä»¥å‡å°‘ç©ºé—´çš„å ç”¨ å¯ä»¥å‚è€ƒä»¥ä¸‹æŒ‡ä»¤:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.flv -c:v libx264 -crf 26 -c:a aac -strict experimental -b:a 128k output.mp4</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Šå„é€‰é¡¹å«ä¹‰ï¼š</strong></p>
<ul>
<li><code>-i input.flv</code>ï¼šæŒ‡å®šè¾“å…¥æ–‡ä»¶åä¸º<code>input.flv</code>ã€‚</li>
<li><code>-c:v libx264</code>ï¼šä½¿ç”¨<code>H.264</code>ç¼–ç æ¥å‹ç¼©è§†é¢‘ã€‚</li>
<li><code>-crf 28</code>ï¼šè®¾ç½®<code>CRF</code>ï¼ˆå¸¸é‡é€Ÿç‡å› å­ï¼‰çš„å€¼ä¸º23ã€‚ä½å€¼è¡¨ç¤ºæ›´å¥½çš„è´¨é‡ï¼Œä½†æ–‡ä»¶ä¼šæ›´å¤§ï¼›é«˜å€¼ä¼šé™ä½è´¨é‡ã€‚èŒƒå›´æ˜¯ä»0ï¼ˆæ— æŸï¼‰åˆ°51ï¼ˆæœ€ç³Ÿï¼‰ï¼Œé€šå¸¸ä½¿ç”¨18åˆ°28, <code>27</code>é€šå¸¸æ˜¯ç”¨äº<code>MP4</code>æ ¼å¼çš„è§†é¢‘è´¨é‡å¾ˆå¥½çš„å¹³è¡¡</li>
<li><code>-c:a aac</code>ï¼šä½¿ç”¨<code>AAC</code>ç¼–ç æ¥å‹ç¼©éŸ³é¢‘ã€‚</li>
<li><code>-strict experimental</code>ï¼šå…è®¸ä½¿ç”¨å®éªŒæ€§çš„ç¼–ç å™¨ã€‚</li>
<li><code>-b:a 128k</code>ï¼šè®¾ç½®éŸ³é¢‘æ¯”ç‰¹ç‡ä¸º128kã€‚æ ¹æ®éœ€æ±‚å¯ä»¥è°ƒæ•´å¤§å°ã€‚</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„å‚æ•°å¹³è¡¡ç‚¹ ç¡®ä¿è§†é¢‘ç”»é¢çš„è´¨é‡çš„åŒæ—¶å°½å¯èƒ½åœ°å‹ç¼©è§†é¢‘ä½“ç§¯</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦å¿«é€Ÿå‹åˆ¶ å‡å°‘ç­‰å¾…æ—¶é—´ è¿˜å¯ä»¥æŒ‡å®šç¼–ç å™¨é¢„è®¾ å¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.flv -c:v libx264 -preset veryfast -crf 24 -c:a aac -b:a 128k output.mp4</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Šé€‰é¡¹å«ä¹‰ï¼š</strong></p>
<ul>
<li><code>-preset veryfast</code>ï¼šæŒ‡å®šç¼–ç å™¨é¢„è®¾ï¼Œ<code>veryfast</code>æä¾›å¿«é€Ÿä½†è´¨é‡è¾ƒä½çš„ç¼–ç , é™¤æ­¤ä¹‹å¤– è¿˜æœ‰<code>fast</code>ã€<code>HQ</code>ã€ <code>SuperHQ</code>ç­‰é¢„è®¾ã€‚</li>
</ul>
<h2 id="ffmpeg-æˆªå–è§†é¢‘"><a href="#ffmpeg-æˆªå–è§†é¢‘" class="headerlink" title="ffmpeg æˆªå–è§†é¢‘"></a>ffmpeg æˆªå–è§†é¢‘</h2><p>è¦ä½¿ç”¨<code>FFmpeg</code>æˆªå–è§†é¢‘ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -ss 00:00:10 -t 00:00:30 -c copy output.mp4</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Šå„é€‰é¡¹å«ä¹‰ï¼š</strong></p>
<ul>
<li><code>-i input.mp4</code> æŒ‡å®šè¾“å…¥è§†é¢‘æ–‡ä»¶ã€‚</li>
<li><code>-ss 00:00:10</code> è¡¨ç¤ºä»è§†é¢‘çš„æŒ‡å®šæ—¶é—´ç‚¹å¼€å§‹æˆªå–ï¼Œè¿™é‡Œæ˜¯ä»10ç§’å¤„å¼€å§‹ã€‚</li>
<li><code>-t 00:00:30</code> è¡¨ç¤ºæˆªå–çš„æ—¶é•¿ï¼Œè¿™é‡Œæ˜¯30ç§’ã€‚</li>
<li><code>-c copy</code> è¡¨ç¤ºå¤åˆ¶ç¼–ç å™¨ï¼Œå³ä¸é‡æ–°ç¼–ç ï¼Œç›´æ¥å¤åˆ¶è§†é¢‘æµå’ŒéŸ³é¢‘æµã€‚</li>
<li><code>output.mp4</code> æ˜¯è¾“å‡ºæ–‡ä»¶çš„åç§°ã€‚</li>
</ul>
<p>è¯·æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´æ—¶é—´å‚æ•°ã€‚å¦‚æœéœ€è¦ä¸åŒçš„èµ·å§‹æ—¶é—´æˆ–æ—¶é•¿ï¼Œåªéœ€ä¿®æ”¹<code>-ss</code>å’Œ<code>-t</code>å‚æ•°å³å¯ã€‚å¦‚æœéœ€è¦å¯¹è§†é¢‘è¿›è¡Œé‡ç¼–ç ï¼Œå¯ä»¥å»æ‰<code>-c copy</code>å‚æ•°æˆ–æŒ‡å®šå…¶ä»–ç¼–ç å™¨é€‰é¡¹ã€‚</p>
<p><strong>æœ¬æ–‡ä¸ºä½œè€…åŸåˆ› è½¬è½½æ—¶è¯·æ³¨æ˜å‡ºå¤„ è°¢è°¢</strong></p>
<p><img src="https://gitee.com/songjianzaina/SavePicGoPic/raw/master/img/20191119095516.png" alt></p>
<p><em><a href="https://code.newban.cn/">ä¹±ç ä¸‰åƒ â€“ ç‚¹æ»´ç§¯ç´¯ ,æ¬¢è¿æ¥åˆ°ä¹±ç ä¸‰åƒæŠ€æœ¯åšå®¢ç«™</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://code.newban.cn462.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¹±ç ä¸‰åƒ â€“ åˆ†äº«å®ç”¨ITæŠ€æœ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="462.html" itemprop="url">å¦‚ä½•å¼€å‘hexoæ’ä»¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2024-04-13T10:14:19+08:00">
                2024-04-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Hexo æœ‰å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿï¼Œä½¿æ‚¨èƒ½è½»æ¾æ‰©å±•åŠŸèƒ½è€Œä¸ç”¨ä¿®æ”¹æ ¸å¿ƒæ¨¡å—çš„æºç ã€‚åœ¨ Hexo ä¸­æœ‰ä¸¤ç§å½¢å¼çš„æ’ä»¶ï¼š</p>
<h3 id="è„šæœ¬ï¼ˆScriptsï¼‰"><a href="#è„šæœ¬ï¼ˆScriptsï¼‰" class="headerlink" title="è„šæœ¬ï¼ˆScriptsï¼‰"></a>è„šæœ¬ï¼ˆScriptsï¼‰</h3><p>å¦‚æœæ‚¨çš„ä»£ç å¾ˆç®€å•ï¼Œå»ºè®®æ‚¨ç¼–å†™è„šæœ¬ï¼Œæ‚¨åªéœ€è¦æŠŠ JavaScript æ–‡ä»¶æ”¾åˆ° <code>scripts</code> æ–‡ä»¶å¤¹ï¼Œåœ¨å¯åŠ¨æ—¶å°±ä¼šè‡ªåŠ¨åŠ è½½ã€‚</p>
<h3 id="æ’ä»¶ï¼ˆPackagesï¼‰"><a href="#æ’ä»¶ï¼ˆPackagesï¼‰" class="headerlink" title="æ’ä»¶ï¼ˆPackagesï¼‰"></a>æ’ä»¶ï¼ˆPackagesï¼‰</h3><p>å¦‚æœæ‚¨çš„ä»£ç è¾ƒå¤æ‚ï¼Œæˆ–æ˜¯æ‚¨æƒ³è¦å‘å¸ƒåˆ° NPM ä¸Šï¼Œå»ºè®®æ‚¨ç¼–å†™æ’ä»¶ã€‚é¦–å…ˆï¼Œåœ¨ <code>node_modules</code> æ–‡ä»¶å¤¹ä¸­å»ºç«‹æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹åç§°å¼€å¤´å¿…é¡»ä¸º <code>hexo-</code>ï¼Œå¦‚æ­¤ä¸€æ¥ Hexo æ‰ä¼šåœ¨å¯åŠ¨æ—¶åŠ è½½ï¼›å¦åˆ™ Hexo å°†ä¼šå¿½ç•¥å®ƒã€‚</p>
<p>æ–‡ä»¶å¤¹å†…è‡³å°‘è¦åŒ…å« 2 ä¸ªæ–‡ä»¶ï¼šä¸€ä¸ªæ˜¯ä¸»ç¨‹åºï¼Œå¦ä¸€ä¸ªæ˜¯ <code>package.json</code>ï¼Œæè¿°æ’ä»¶çš„ç”¨é€”å’Œæ‰€ä¾èµ–çš„æ’ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ index.js</span><br><span class="line">â””â”€â”€ package.json</span><br></pre></td></tr></table></figure>

<p><code>package.json</code> ä¸­è‡³å°‘è¦åŒ…å« <code>name</code>, <code>version</code>, <code>main</code> å±æ€§ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package.json&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"hexo-my-plugin"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"index"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><p>æ‚¨å¯ä»¥ä½¿ç”¨ Hexo æä¾›çš„å®˜æ–¹å·¥å…·æ’ä»¶æ¥åŠ é€Ÿå¼€å‘ï¼š</p>
<ul>
<li><a href="https://github.com/hexojs/hexo-fs" target="_blank" rel="noopener">hexo-fs</a>ï¼šæ–‡ä»¶ IO</li>
<li><a href="https://github.com/hexojs/hexo-util" target="_blank" rel="noopener">hexo-util</a>ï¼šå·¥å…·ç¨‹å¼</li>
<li><a href="https://github.com/hexojs/hexo-i18n" target="_blank" rel="noopener">hexo-i18n</a>ï¼šæœ¬åœ°åŒ–ï¼ˆi18nï¼‰</li>
<li><a href="https://github.com/hexojs/hexo-pagination" target="_blank" rel="noopener">hexo-pagination</a>ï¼šç”Ÿæˆåˆ†é¡µæ•°æ®</li>
</ul>
<h3 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h3><p>å½“æ‚¨å®Œæˆæ’ä»¶åï¼Œå¯ä»¥è€ƒè™‘å°†å®ƒå‘å¸ƒåˆ° <a href="https://hexo.io/plugins" target="_blank" rel="noopener">æ’ä»¶åˆ—è¡¨</a>ï¼Œè®©æ›´å¤šäººèƒ½å¤Ÿä½¿ç”¨æ‚¨çš„æ’ä»¶ã€‚å‘å¸ƒæ’ä»¶çš„æ­¥éª¤å’Œ <a href="https://hexo.io/zh-cn/docs/contributing.html#æ›´æ–°æ–‡æ¡£" target="_blank" rel="noopener">æ›´æ–°æ–‡æ¡£</a> éå¸¸ç±»ä¼¼ã€‚</p>
<ol>
<li><p>Fork <a href="https://github.com/hexojs/site" target="_blank" rel="noopener">hexojs/site</a></p>
</li>
<li><p>æŠŠåº“ï¼ˆrepositoryï¼‰å¤åˆ¶åˆ°ç”µè„‘ä¸Šï¼Œå¹¶å®‰è£…æ‰€ä¾èµ–çš„æ’ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/&lt;username&gt;/site.git</span><br><span class="line">$ <span class="built_in">cd</span> site</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ <code>source/_data/plugins/</code> ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ yaml æ–‡ä»¶ï¼Œä½¿ç”¨æ‚¨çš„æ’ä»¶åç§°ä½œä¸ºæ–‡ä»¶åã€‚</p>
</li>
<li><p>ç¼–è¾‘ <code>source/_data/plugins/&lt;your-plugin-name&gt;.yml</code> å¹¶æ·»åŠ æ‚¨çš„æ’ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">description:</span> <span class="string">Server</span> <span class="string">module</span> <span class="string">for</span> <span class="string">Hexo.</span></span><br><span class="line"><span class="attr">link:</span> <span class="attr">https://github.com/hexojs/hexo-server</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">official</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">server</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">console</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¨é€ï¼ˆpushï¼‰åˆ†æ”¯ã€‚</p>
</li>
<li><p>å»ºç«‹ä¸€ä¸ªæ–°çš„åˆå¹¶ç”³è¯·ï¼ˆpull requestï¼‰å¹¶æè¿°æ”¹åŠ¨ã€‚</p>
</li>
</ol>
<p><strong>æœ¬æ–‡è½¬è½½è‡ª</strong> : <a href="https://hexo.io/zh-cn/docs/plugins" target="_blank" rel="noopener">Hexoä¸­æ–‡ç½‘</a></p>
<p><img src="https://gitee.com/songjianzaina/SavePicGoPic/raw/master/img/20191119095516.png" alt></p>
<p><em><a href="https://code.newban.cn/">ä¹±ç ä¸‰åƒ â€“ ç‚¹æ»´ç§¯ç´¯ ,æ¬¢è¿æ¥åˆ°ä¹±ç ä¸‰åƒæŠ€æœ¯åšå®¢ç«™</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="page/47/">47</a><a class="extend next" rel="next" href="page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ä¹±ç ä¸‰åƒ</p>
              <p class="site-description motion-element" itemprop="description">androidç¨‹åºå‘˜ä¸€æš,æ“…é•¿java,kotlin,python,é‡‘èæŠ•èµ„,æ¬¢è¿äº¤æµ~</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://code.newban.cn/archives/">
              
                  <span class="site-state-item-count">469</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">138</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ä¹±ç ä¸‰åƒ</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡</span>
  </div>
  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
